                         4 .list
                         5 ***************************************************************
                         6 ** ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 ***************************************************************
                         8 ***************
                         9 ** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        10 ***************
                        11 .equ REGBASE, 0xFFF000 | DMAP „Çí‰ΩøÁî®Ôºé
                        12 .equ IOBASE, 0x00d00000
                        13 ***************
                        14 ** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        15 ***************
                        16 .equ IVR, REGBASE+0x300 | Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        17 .equ IMR, REGBASE+0x304 | Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        18 .equ ISR, REGBASE+0x30c | Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        19 .equ IPR, REGBASE+0x310 | Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        20 ***************
                        21 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        22 ***************
                        23 .equ TCTL1, REGBASE+0x600 	| „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        24 .equ TPRER1, REGBASE+0x602  | „Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        25 .equ TCMP1, REGBASE+0x604 	| „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        26 .equ TCN1, REGBASE+0x608 	| „Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        27 .equ TSTAT1, REGBASE+0x60a 	| „Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        28 ***************
                        29 ** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        30 ***************
                        31 .equ USTCNT1, REGBASE+0x900 | UART1 „Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        32 .equ UBAUD1, REGBASE+0x902 	| UART1 „Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        33 .equ URX1, REGBASE+0x904 	| UART1 Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        34 .equ UTX1, REGBASE+0x906 	| UART1 ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        35 ***************
                        36 ** LED
                        37 ***************
                        38 .equ LED7, IOBASE+0x000002f | „Éú„Éº„ÉâÊê≠Ëºâ„ÅÆ LED Áî®„É¨„Ç∏„Çπ„Çø
                        39 .equ LED6, IOBASE+0x000002d | ‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤ A.4.3.1
                        40 .equ LED5, IOBASE+0x000002b
                        41 .equ LED4, IOBASE+0x0000029
                        42 .equ LED3, IOBASE+0x000003f
                        43 .equ LED2, IOBASE+0x000003d
                        44 .equ LED1, IOBASE+0x000003b
                        45 .equ LED0, IOBASE+0x0000039
                        46 **************
                        47 ** Êé®Â•®ÂÄ§
                        48 **************
                        49 .equ Mask_None,       0xFF3FFF
                        50 .equ Mask_UART1,      0xFF3FFB
                        51 .equ Mask_UART1_Timer,0xFF3FF9
                        52 **Timer
                        53 
                        54 **UART1
                        55 .equ U_Reset,   	  		0x0000
                        56 .equ U_Putpull,		  		0xE100
                        57 .equ U_Put_Interupt,  		0xE108
                        58 .equ U_PutPull_Interupt,	0xE10C
                        59 ***************************************************************
                        60 ** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        61 ***************************************************************
                        62 .section .bss
                        63 .even
000704 0000 0000        64 SYS_STK:.ds.b 0x4000 | „Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        64 
       0000 0000        64 
       0000 0000        64 
       0000 0000        64 
                        65 .even
                        66 SYS_STK_TOP: | „Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        67 *****************************************************************
                        68 **„Ç≠„É•„Éº
                        69 *****************************************************************
004704 0000 0000        70 top0:		.ds.b	255			/*„Ç≠„É•„Éº„ÅÆÊà¶Èóò„ÅÆÁï™Âú∞*/
       0000 0000        70 
       0000 0000        70 
       0000 0000        70 
       0000 0000        70 
004803 00               71 bottom0:	.ds.b	1			/*„Ç≠„É•„Éº„ÅÆÊú´Â∞æ„ÅÆÁï™Âú∞*/
004804 0000 0000        72 out0:		.ds.l	1			/*Ê¨°„Å´Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆ„ÅÇ„ÇãÁï™Âú∞*/
004808 0000 0000        73 in0:		.ds.l	1 			/*Ê¨°„Å´„Éá„Éº„Çø„ÇíÂÖ•„Çå„Çã„Åπ„ÅçÁï™Âú∞*/
00480c 0000 0000        74 s0:		.ds.l	1			/*„Ç≠„É•„Éº„Å´Ê∫ú„Åæ„Å£„Å¶„ÅÑ„Çã„Éá„Éº„Çø„ÅÆÊï∞*/
                        75 
004810 0000 0000        76 top1:		.ds.b	255			/*„Ç≠„É•„Éº„ÅÆÊà¶Èóò„ÅÆÁï™Âú∞*/
       0000 0000        76 
       0000 0000        76 
       0000 0000        76 
       0000 0000        76 
00490f 00               77 bottom1:	.ds.b	1			/*„Ç≠„É•„Éº„ÅÆÊú´Â∞æ„ÅÆÁï™Âú∞*/
004910 0000 0000        78 out1:		.ds.l	1			/*Ê¨°„Å´Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆ„ÅÇ„ÇãÁï™Âú∞*/
004914 0000 0000        79 in1:		.ds.l	1 			/*Ê¨°„Å´„Éá„Éº„Çø„ÇíÂÖ•„Çå„Çã„Åπ„ÅçÁï™Âú∞*/
004918 0000 0000        80 s1:		.ds.l	1			/*„Ç≠„É•„Éº„Å´Ê∫ú„Åæ„Å£„Å¶„ÅÑ„Çã„Éá„Éº„Çø„ÅÆÊï∞*/
                        81 ***************************************************************
                        82 ** ÂàùÊúüÂåñ
                        83 ** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        84 ** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤ B „Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        85 ***************************************************************
                        86 .section .text
                        87 .even
                        88 boot: * „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂ & ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        89 move.w #0x2700,%SR
000404 4FF9 0000        90 lea.l SYS_STK_TOP, %SP 			| Set SSP
       0000             90 
                        91 
                        92 ****************
                        93 ** Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        94 ****************
00040a 13FC 0040        95 move.b #0x40, IVR 				| „É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí0x40+level „Å´Ë®≠ÂÆöÔºé
       00FF F300        95 
000412 21FC 0000        96 move.l #HardwareInterface ,0x110| ÈÄÅÂèó‰ø°Ââ≤Ëæº„Åø„ÇíË®≠ÂÆö
       0000 0110        96 
00041a 23FC 00FF        97 move.l #Mask_None,IMR 			| All Mask
       3FFF 00FF        97 
       F304             97 
                        98 
                        99 ****************
                       100 ** ÈÄÅÂèó‰ø° (UART1) Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ (Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ 4 „Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       101 ****************
000424 33FC 0000       102 move.w #U_Reset, USTCNT1 		| „É™„Çª„ÉÉ„Éà
       00FF F900       102 
00042c 33FC E100       103 move.w #U_Putpull, USTCNT1 	    |Âèó‰ø°ÈÄÅ‰ø°ÂèØËÉΩ
       00FF F900       103 
000434 33FC 0038       104 move.w #0x0038, UBAUD1 			| baud rate = 230400 bps
       00FF F902       104 
                       105 
                       106 ****************
                       107 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ (Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ 6 „Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       108 *****************
00043c 33FC 0004       109 move.w #0x0004, TCTL1 | restart, Ââ≤„ÇäËæº„Åø‰∏çÂèØ,
       00FF F600       109 
                       110 | „Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ 1/16 „ÇíÂçò‰Ωç„Å®„Åó„Å¶Ë®àÊôÇÔºåa
                       111 | „Çø„Ç§„Éû‰ΩøÁî®ÂÅúÊ≠¢
                       112 
                       113 *****************
                       114 **„Ç≠„É•„ÉºÂàùÊúüÂåñ
                       115 *****************
                       116 
000444 41F9 0000       117 lea.l	top0,%a0
       0000            117 
00044a 23C8 0000       118 move.l	%a0,in0
       0000            118 
000450 23C8 0000       119 move.l  %a0,out0
       0000            119 
000456 23FC 0000       120 move.l	#0,s0
       0000 0000       120 
       0000            120 
000460 41F9 0000       121 lea.l	top1,%a0
       0000            121 
000466 23C8 0000       122 move.l	%a0,in1
       0000            122 
00046c 23C8 0000       123 move.l  %a0,out1
       0000            123 
000472 23FC 0000       124 move.l	#0,s1
       0000 0000       124 
       0000            124 
00047c 6000 0002       125 bra MAIN
                       126 
                       127 MAIN:
000480 4EBA 0024       128     jsr Put
000484 46FC 2000       129     move.w #0x2000,%SR
000488 23FC 00FF       130     move.l #Mask_UART1,IMR 			| All Mask
       3FFB 00FF       130 
       F304            130 
000492 33FC E10C       131     move.w #U_PutPull_Interupt, USTCNT1 	    |Âèó‰ø°ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ
       00FF F900       131 
00049a 13FC 0053       132     move.b #'S',LED0
       00D0 0039       132 
                       133 Loop:
                       134 	**jmp HardwareInterface /* TODO: debugÁî®„ÄÇÂæå„ÅßÊ∂à„Åô */
0004a2 6000 FFFE       135 	bra Loop
                       136 
                       137 ********INTERPUT„ÅÆÂãï‰Ωú„ÉÜ„Çπ„Éà
                       138 ********„Ç≠„É•„Éº„Å´ÊñáÂ≠ó„ÇíÊ†ºÁ¥ç„Åô„Çã
                       139 Put:
0004a6 48E7 E000       140     movem.l %d0-%d2, -(%sp)
0004aa 123C 0061       141     move.b #0x61, %d1  |d0='a'
0004ae 143C 0010       142     move.b #16, %d2
                       143 PutLoop:
0004b2 7001            144     move.l #1,%d0
0004b4 4EBA 0032       145     jsr INQ
0004b8 0C80 0000       146     cmpi.l #0,%d0
       0000            146 
0004be 6700 0018       147     beq EndPut
0004c2 5302            148     subq.b #1 , %d2
0004c4 6700 0006       149     beq EndPutLoop
0004c8 6000 FFE8       150     bra PutLoop
                       151 EndPutLoop:
0004cc 0601 0001       152     addi.b #1,%d1
0004d0 143C 0010       153     move.b #16,%d2
0004d4 6000 FFDC       154     bra PutLoop
                       155 
                       156 EndPut:
0004d8 23FC 0000       157     move.l #256, s1
       0100 0000       157 
       0000            157 
0004e2 4CDF 0007       158     movem.l (%sp)+,%d0-%d2 
0004e6 4E75            159     rts
                       160 
                       161 
                       162 
                       163 
                       164 
                       165 INQ:
                       166 	**	Áï™Âè∑no„ÅÆ„Ç≠„É•„Éº„Å´„Éá„Éº„Çø„Çí„ÅÑ„Çå„Çã
                       167 	**	ÂÖ•Âäõ no->d0.l	Êõ∏„ÅçËæº„ÇÄ8bitdata->d1.b
                       168 	**	Âá∫Âäõ Â§±Êïó0/ÊàêÂäü1 ->d0.l
0004e8 48E7 20C0       169 	movem.l	%a0/%a1/%d2,-(%sp)	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Å´„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
0004ec 40E7            170 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
0004ee 46FC 2700       171 	move.w 	#0x2700,%SR			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
0004f2 0C80 0000       172 	cmp.l 	#0,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå0*/
       0000            172 
0004f8 6700 0010       173 	beq	INQ0
0004fc 0C80 0000       174 	cmp.l 	#1,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå1*/
       0001            174 
000502 6700 004C       175 	beq	INQ1
000506 4EFA 013C       176 	jmp	Queue_fail		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ*/
                       177 
                       178 	
                       179 INQ0:	
00050a 0CB9 0000       180 	cmp.l	#256,s0
       0100 0000       180 
       0000            180 
000514 6700 012E       181 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
000518 2079 0000       182 	move.l	in0,%a0			
       0000            182 
00051e 1081            183 	move.b	%d1,(%a0)		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Å´Êõ∏„ÅçËæº„Åø*/
000520 43F9 0000       184 	lea.l	bottom0,%a1
       0000            184 
000526 B1C9            185 	cmp.l	%a1,%a0
000528 6700 000C       186 	beq	INQ0_step1		/*in==bottom„ÅÆ„Å®„Åçin=top*/
00052c 52B9 0000       187 	add.l	#1,in0			/*in++*/
       0000            187 
000532 4EFA 000C       188 	jmp	INQ0_step2
                       189 
                       190 INQ0_step1:
000536 23F9 0000       191 	move.l top0,in0
       0000 0000       191 
       0000            191 
                       192 
                       193 INQ0_step2:
000540 52B9 0000       194 	add.l	#1,s0 			/*s++*/
       0000            194 
000546 7001            195 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
000548 46DF            196 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
00054a 4CDF 0304       197 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
00054e 4E75            198 	rts
                       199 
                       200 INQ1:	
000550 0CB9 0000       201 	cmp.l	#256,s1
       0100 0000       201 
       0000            201 
00055a 6700 00E8       202 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
00055e 2079 0000       203 	move.l	in1,%a0			
       0000            203 
000564 1081            204 	move.b	%d1,(%a0)		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Å´Êõ∏„ÅçËæº„Åø*/
000566 43F9 0000       205 	lea.l	bottom1,%a1
       0000            205 
00056c B1C9            206 	cmp.l	%a1,%a0
00056e 6700 000C       207 	beq	INQ1_step1		/*in==bottom„ÅÆ„Å®„Åçin=top*/
000572 52B9 0000       208 	add.l	#1,in1			/*in++*/
       0000            208 
000578 4EFA 000C       209 	jmp	INQ1_step2
                       210 
                       211 INQ1_step1:
00057c 23F9 0000       212 	move.l top1,in1
       0000 0000       212 
       0000            212 
                       213 
                       214 INQ1_step2:
000586 52B9 0000       215 	add.l	#1,s1 			/*s++*/
       0000            215 
00058c 7001            216 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
00058e 46DF            217 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000590 4CDF 0304       218 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
000594 4E75            219 	rts
                       220 
                       221 
                       222 OUTQ:
                       223 	**	Áï™Âè∑no„ÅÆ„Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„Çí‰∏Ä„Å§Âèñ„ÇäÂá∫„Åô
                       224 	**	ÂÖ•Âäõ „Ç≠„É•„Éº„ÅÆÁï™Âè∑->d0.l
                       225 	**	Âá∫Âäõ Â§±Êïó0/ÊàêÂäü1 ->d0.l		Âèñ„ÇäÂá∫„Åó„Åü8bitdata ->d1.b
000596 48E7 20C0       226 	movem.l	%a0/%a1/%d2,-(%sp)	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Å´„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
00059a 40E7            227 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
00059c 46FC 2700       228 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
0005a0 0C80 0000       229 	cmp.l 	#0,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå0*/
       0000            229 
0005a6 6700 0010       230 	beq	OUTQ0
0005aa 0C80 0000       231 	cmp.l 	#1,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå1*/
       0001            231 
0005b0 6700 004C       232 	beq	OUTQ1
0005b4 4EFA 008E       233 	jmp	Queue_fail		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ*/
                       234 	
                       235 
                       236 OUTQ0:	
0005b8 0CB9 0000       237 	cmp.l	#0,s0
       0000 0000       237 
       0000            237 
0005c2 6700 0080       238 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
0005c6 2079 0000       239 	move.l	out0,%a0			
       0000            239 
0005cc 1210            240 	move.b	(%a0),%d1		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Åã„ÇâÂèñ„ÇäÂá∫„Åó*/
0005ce 43F9 0000       241 	lea.l	bottom0,%a1
       0000            241 
0005d4 B1C9            242 	cmp.l	%a1,%a0
0005d6 6700 000C       243 	beq	OUTQ0_step1		/*out==bottom„ÅÆ„Å®„Åçout=top*/
0005da 52B9 0000       244 	add.l	#1,out0			/*out++*/
       0000            244 
0005e0 4EFA 000C       245 	jmp	OUTQ0_step2
                       246 
                       247 OUTQ0_step1:
0005e4 23F9 0000       248 	move.l top0,out0
       0000 0000       248 
       0000            248 
                       249 
                       250 OUTQ0_step2:
0005ee 53B9 0000       251 	sub.l	#1,s0 			/*s--*/
       0000            251 
0005f4 7001            252 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
0005f6 46DF            253 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0005f8 4CDF 0304       254 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
0005fc 4E75            255 	rts
                       256 
                       257 OUTQ1:	
0005fe 0CB9 0000       258 	cmp.l	#0,s1
       0000 0000       258 
       0000            258 
000608 6700 003A       259 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
00060c 2079 0000       260 	move.l	out1,%a0			
       0000            260 
000612 1210            261 	move.b	(%a0),%d1		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Åã„ÇâÂèñ„ÇäÂá∫„Åó*/
000614 43F9 0000       262 	lea.l	bottom1,%a1
       0000            262 
00061a B1C9            263 	cmp.l	%a1,%a0
00061c 6700 000C       264 	beq	OUTQ1_step1		/*out==bottom„ÅÆ„Å®„Åçout=top*/
000620 52B9 0000       265 	add.l	#1,out1			/*out++*/
       0000            265 
000626 4EFA 000C       266 	jmp	OUTQ1_step2
                       267 
                       268 OUTQ1_step1:
00062a 23F9 0000       269 	move.l top1,out1
       0000 0000       269 
       0000            269 
                       270 
                       271 OUTQ1_step2:
000634 53B9 0000       272 	sub.l	#1,s1 			/*s--*/
       0000            272 
00063a 7001            273 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
00063c 46DF            274 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
00063e 4CDF 0304       275 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
000642 4E75            276 	rts
                       277 
                       278 Queue_fail:
000644 7000            279 	move.l #0,%d0			/*Â§±Êïó„ÅÆÂ†±Âëä*/
000646 46DF            280 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000648 4CDF 0304       281 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
00064c 4E75            282 	rts
                       283 
                       284 INTERGET:
00064e 0642 0800       285 	add.w #0x0800,%d2
000652 33C2 00FF       286 	move.w  %d2,UTX1
       F906            286 
000658 13FC 0031       287 	move.b #'1',LED7
       00D0 002F       287 
000660 4CDF FFFE       288 	movem.l (%sp)+,%a0-%a7/%d1-%d7
000664 4E75            289 	rts
                       290 
                       291 /* INTERPUT(ch)„ÄÄ„ÉÅ„É£„É≥„Éç„É´ch„ÅÆÈÄÅ‰ø°„Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„Çí‰∏Ä„Å§Âèñ„ÇäÂá∫„ÅóÂÆüÈöõ„Å´È
                       292 ÂÖ•ÂäõÔºöch->%D1.l */
                       293 INTERPUT:
000666 13FC 0049       294 	move.b #'I',LED2
       00D0 003D       294 
00066e 40E7            295 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
000670 46FC 2700       296 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
000674 0C81 0000       297 	cmp.l 	#0,%d1
       0000            297 
00067a 6600 0034       298 	bne	INTERPUT_END		/*ch„Åå0„Åß„Å™„ÅÑ„Å™„Çâ‰Ωï„ÇÇ„Åõ„Åö„Å´Âæ©Â∏∞*/
00067e 7001            299     	move.l #1 , %d0          /* „Ç≠„É•„Éº1„ÇíÈÅ∏Êäû */
000680 4EBA FF14       300 	jsr	OUTQ		        /*data->%D1.b  %D0„Å´ÁµêÊûú„ÇíÊ†ºÁ¥ç*/
000684 0C80 0000       301 	cmp.l	#0,%d0
       0000            301 
00068a 6700 0010       302 	beq	INTERPUT_fail
00068e 0641 0800       303 	add.w	#0x0800,%d1
000692 33C1 00FF       304 	move.w	%d1,UTX1	/*Á¨¶Âè∑Êã°Âºµ„Åó„Å¶data„ÇíUTX1„Å´Ê†ºÁ¥ç*/
       F906            304 
000698 4EFA 0016       305 	jmp 	INTERPUT_END
                       306 INTERPUT_fail:
00069c 13FC 0046       307 	move.b #'F',LED3
       00D0 003F       307 
0006a4 33FC E108       308 	move.w	#U_Put_Interupt,USTCNT1	/*OUTQ„ÅåÂ§±Êïó„Å™„ÇâÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢„Å´„Åó„Å¶Âæ©Â∏∞*/
       00FF F900       308 
0006ac 46DF            309 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0006ae 4E75            310 	rts
                       311 INTERPUT_END:
0006b0 46DF            312 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0006b2 4E75            313 	rts
                       314 
                       315 HardwareInterface: 
0006b4 13FC 0048       316 	move.b #'H',LED1
       00D0 003B       316 
0006bc 48E7 7FFF       317 	movem.l %a0-%a7/%d1-%d7, -(%sp)
0006c0 3639 00FF       318 	move.w URX1,%d3
       F904            318 
0006c6 1403            319 	move.b %d3,%d2 /* data = %d2.b */
0006c8 0243 2000       320 	andi.w #0x2000,%d3
0006cc 0C43 2000       321 	cmpi.w #0x2000,%d3 /* URX1„ÅÆ13bitÁõÆ„Åå1„ÅÆÂ†¥ÂêàINTERGETÂëº„Å≥Âá∫„Åó */
0006d0 6700 001A       322 	beq INTERGET_PREPARE
0006d4 3239 00FF       323 	move.w UTX1,%d1
       F906            323 
                       324 	**move #0x8000,%d1
0006da 0241 8000       325 	and.w #0x8000,%d1 
0006de 0C41 8000       326 	cmp #0x8000,%d1
0006e2 6700 0014       327 	beq INTERPUT_PREPARE
0006e6 4CDF FFFE       328         movem.l (%sp)+,%a0-%a7/%d1-%d7 
0006ea 4E73            329 	rte
                       330 INTERGET_PREPARE:
0006ec 7200            331 	moveq.l #0,%d1 /* ch = %d1.l = 0 */
0006ee 4EBA FF5E       332 	jsr INTERGET
0006f2 4CDF FFFE       333     	movem.l (%sp)+,%a0-%a7/%d1-%d7
0006f6 4E73            334     	rte
                       335 INTERPUT_PREPARE:
0006f8 7200            336     	move.l #0, %d1
0006fa 4EBA FF6A       337     	jsr INTERPUT
0006fe 4CDF FFFE       338     	movem.l (%sp)+,%a0-%a7/%d1-%d7
000702 4E73            339     	rte
                       340 .end
