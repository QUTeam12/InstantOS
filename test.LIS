                         4 .list
                         5 ***************************************************************
                         6 ** ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 ***************************************************************
                         8 ***************
                         9 ** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        10 ***************
                        11 .equ REGBASE, 0xFFF000 | DMAP „Çí‰ΩøÁî®Ôºé
                        12 .equ IOBASE, 0x00d00000
                        13 ***************
                        14 ** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        15 ***************
                        16 .equ IVR, REGBASE+0x300 | Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        17 .equ IMR, REGBASE+0x304 | Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        18 .equ ISR, REGBASE+0x30c | Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        19 .equ IPR, REGBASE+0x310 | Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        20 ***************
                        21 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        22 ***************
                        23 .equ TCTL1, REGBASE+0x600 | „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        24 .equ TPRER1, REGBASE+0x602 | „Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        25 .equ TCMP1, REGBASE+0x604 | „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        26 .equ TCN1, REGBASE+0x608 | „Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        27 .equ TSTAT1, REGBASE+0x60a | „Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        28 ***************
                        29 ** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        30 ***************
                        31 .equ USTCNT1, REGBASE+0x900 | UART1 „Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        32 .equ UBAUD1, REGBASE+0x902 | UART1 „Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        33 .equ URX1, REGBASE+0x904 | UART1 Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        34 .equ UTX1, REGBASE+0x906 | UART1 ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        35 ***************
                        36 ** LED
                        37 ***************
                        38 .equ LED7, IOBASE+0x000002f | „Éú„Éº„ÉâÊê≠Ëºâ„ÅÆ LED Áî®„É¨„Ç∏„Çπ„Çø
                        39 .equ LED6, IOBASE+0x000002d | ‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤ A.4.3.1
                        40 .equ LED5, IOBASE+0x000002b
                        41 .equ LED4, IOBASE+0x0000029
                        42 .equ LED3, IOBASE+0x000003f
                        43 .equ LED2, IOBASE+0x000003d
                        44 .equ LED1, IOBASE+0x000003b
                        45 .equ LED0, IOBASE+0x0000039
                        46 **************
                        47 ** Êé®Â•®ÂÄ§
                        48 **************
                        49 .equ Mask_None,       0xFF3FFF
                        50 .equ Mask_UART1,      0xFF3FFB
                        51 .equ Mask_UART1_Timer,0xFF3FF9
                        52 **Timer
                        53 
                        54 **UART1
                        55 .equ U_Reset,   0x0000
                        56 .equ U_Putpull, 0xE100
                        57 .equ U_Putonly, 0xE108
                        58 .equ U_Pullonly,0xE10C
                        59 ***************************************************************
                        60 ** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        61 ***************************************************************
                        62 .section .bss
                        63 .even
0006e4 0000 0000        64 SYS_STK:.ds.b 0x4000 | „Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        64 
       0000 0000        64 
       0000 0000        64 
       0000 0000        64 
                        65 .even
                        66 SYS_STK_TOP: | „Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        67 *****************************************************************
                        68 **„Ç≠„É•„Éº
                        69 *****************************************************************
0046e4 0000 0000        70 top0:		.ds.b	255			/*„Ç≠„É•„Éº„ÅÆÊà¶Èóò„ÅÆÁï™Âú∞*/
       0000 0000        70 
       0000 0000        70 
       0000 0000        70 
       0000 0000        70 
0047e3 00               71 bottom0:	.ds.b	1			/*„Ç≠„É•„Éº„ÅÆÊú´Â∞æ„ÅÆÁï™Âú∞*/
0047e4 0000 0000        72 out0:		.ds.l	1			/*Ê¨°„Å´Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆ„ÅÇ„ÇãÁï™Âú∞*/
0047e8 0000 0000        73 in0:		.ds.l	1 			/*Ê¨°„Å´„Éá„Éº„Çø„ÇíÂÖ•„Çå„Çã„Åπ„ÅçÁï™Âú∞*/
0047ec 0000 0000        74 s0:		.ds.l	1			/*„Ç≠„É•„Éº„Å´Ê∫ú„Åæ„Å£„Å¶„ÅÑ„Çã„Éá„Éº„Çø„ÅÆÊï∞*/
                        75 
0047f0 0000 0000        76 top1:		.ds.b	255			/*„Ç≠„É•„Éº„ÅÆÊà¶Èóò„ÅÆÁï™Âú∞*/
       0000 0000        76 
       0000 0000        76 
       0000 0000        76 
       0000 0000        76 
0048ef 00               77 bottom1:	.ds.b	1			/*„Ç≠„É•„Éº„ÅÆÊú´Â∞æ„ÅÆÁï™Âú∞*/
0048f0 0000 0000        78 out1:		.ds.l	1			/*Ê¨°„Å´Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆ„ÅÇ„ÇãÁï™Âú∞*/
0048f4 0000 0000        79 in1:		.ds.l	1 			/*Ê¨°„Å´„Éá„Éº„Çø„ÇíÂÖ•„Çå„Çã„Åπ„ÅçÁï™Âú∞*/
0048f8 0000 0000        80 s1:		.ds.l	1			/*„Ç≠„É•„Éº„Å´Ê∫ú„Åæ„Å£„Å¶„ÅÑ„Çã„Éá„Éº„Çø„ÅÆÊï∞*/
                        81 	
0048fc 0000 0000        82 out_data:	 .ds.l 	300
       0000 0000        82 
       0000 0000        82 
       0000 0000        82 
       0000 0000        82 
004dac 0000 0000        83 out_status:	 .ds.l 	300
       0000 0000        83 
       0000 0000        83 
       0000 0000        83 
       0000 0000        83 
00525c 0000 0000        84 in_status:	 .ds.l 	300
       0000 0000        84 
       0000 0000        84 
       0000 0000        84 
       0000 0000        84 
00570c 0000 0000        85 in_data:	 .ds.l	300
       0000 0000        85 
       0000 0000        85 
       0000 0000        85 
       0000 0000        85 
                        86 
                        87 ***************************************************************
                        88 ** ÂàùÊúüÂåñ
                        89 ** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        90 ** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤ B „Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        91 ***************************************************************
                        92 .section .text
                        93 .even
                        94 boot: * „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂ & ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        95 move.w #0x2700,%SR
000404 4FF9 0000        96 lea.l SYS_STK_TOP, %SP | Set SSP
       0000             96 
                        97 ****************
                        98 ** Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        99 ****************
00040a 13FC 0040       100 move.b #0x40, IVR | „É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí0x40+level „Å´Ë®≠ÂÆöÔºé
       00FF F300       100 
000412 21FC 0000       101 move.l #HardwareInterface ,0x110
       0000 0110       101 
00041a 23FC 00FF       102 move.l #Mask_UART1,IMR | ÈÄÅÂèó‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ
       3FFB 00FF       102 
       F304            102 
                       103 ****************
                       104 ** ÈÄÅÂèó‰ø° (UART1) Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ (Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ 4 „Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       105 ****************
000424 33FC 0000       106 move.w #U_Reset, USTCNT1 | „É™„Çª„ÉÉ„Éà
       00FF F900       106 
00042c 33FC E10C       107 move.w #U_Pullonly, USTCNT1 |„ÄÄÂèó‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ
       00FF F900       107 
000434 33FC 0038       108 move.w #0x0038, UBAUD1 | baud rate = 230400 bps
       00FF F902       108 
                       109 ****************
                       110 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ (Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ 6 „Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       111 *****************
00043c 33FC 0004       112 move.w #0x0004, TCTL1 | restart, Ââ≤„ÇäËæº„Åø‰∏çÂèØ,
       00FF F600       112 
                       113 | „Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ 1/16 „ÇíÂçò‰Ωç„Å®„Åó„Å¶Ë®àÊôÇÔºåa
                       114 | „Çø„Ç§„Éû‰ΩøÁî®ÂÅúÊ≠¢
                       115 
                       116 **„Ç≠„É•„ÉºÂàùÊúüÂåñ
000444 48E7 0080       117 	movem.l	%a0,-(%sp)	/*Ëµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø*/
000448 46FC 2700       118 	move.w 	#0x2700,%SR		/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
00044c 41F9 0000       119 	lea.l	top0,%a0
       0000            119 
000452 23C8 0000       120 	move.l	%a0,in0
       0000            120 
000458 23C8 0000       121 	move.l  %a0,out0
       0000            121 
00045e 23FC 0000       122 	move.l	#0,s0
       0000 0000       122 
       0000            122 
000468 41F9 0000       123 	lea.l	top1,%a0
       0000            123 
00046e 23C8 0000       124 	move.l	%a0,in1
       0000            124 
000474 23C8 0000       125 	move.l  %a0,out1
       0000            125 
00047a 23FC 0000       126 	move.l	#0,s1
       0000 0000       126 
       0000            126 
000484 4CDF 0100       127 	movem.l (%sp)+,%a0      /* Ëµ∞Ë°å„É¨„Éô„É´„ÅÆÂæ©Â∏∞ */
                       128 **„Çπ„Çø„ÉÉ„ÇØ„É¨„Ç∏„Çπ„ÇøÊìç‰Ωú
000488 6000 0002       129 bra MAIN
                       130 ***************************************************************
                       131 **ÁèæÊÆµÈöé„Åß„ÅÆÂàùÊúüÂåñ„É´„Éº„ÉÅ„É≥„ÅÆÊ≠£Â∏∏Âãï‰Ωú„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅÔºåÊúÄÂæå„Å´ ‚Äôa‚Äô „Çí
                       132 **ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø UTX1 „Å´Êõ∏„ÅçËæº„ÇÄÔºé‚Äôa‚Äô „ÅåÂá∫Âäõ„Åï„Çå„Çå„Å∞ÔºåOK.
                       133 ***************************************************************
                       134 .section .text
                       135 .even
                       136 MAIN:
00048c 46FC 2000       137 	move.w #0x2000, %SR
000490 4EFA 0006       138 	jmp inter_put_test
000494 6000 FFF6       139 	bra MAIN
                       140 
                       141 inter_put_test:
000498 48E7 00C0       142 	movem.l %a0/%a1,-(%sp)
00049c 307C 0010       143 	move.w 	#16,%a0
0004a0 43F9 0000       144 	lea.l	ABC,%a1
       0000            144 
0004a6 0C11 0000       145 	cmp.b	#0,(%a1)
0004aa 6700 002A       146 	beq	end_program
                       147 inter_put_loop:
0004ae B0FC 0000       148 	cmp.w	#0,%a0
0004b2 6700 0010       149 	beq	to_inter_put_test
0004b6 7001            150 	move.l	#1,%d0
0004b8 1211            151 	move.b	(%a1),%d1
0004ba 5348            152 	sub.w	#1,%a0
0004bc 4EBA 0048       153 	jsr	INQ
0004c0 4EFA FFEC       154 	jmp	inter_put_loop
                       155 
                       156 to_inter_put_test:
0004c4 5289            157 	add.l	#1,%a1
0004c6 0C11 0000       158 	cmp.b   #0,(%a1)
0004ca 6700 000A       159 	beq     end_program
0004ce 307C 0010       160 	move.w	#16,%a0
0004d2 4EFA FFDA       161 	jmp	inter_put_loop
                       162 
                       163 end_program:
0004d6 2439 0000       164 	move.l	top1,%d2
       0000            164 
0004dc 23C2 0000       165 	move.l 	%d2,out1
       0000            165 
0004e2 23FC 0000       166 	move.l	#256,s1
       0100 0000       166 
       0000            166 
0004ec 46FC 2000       167 	move.w 	#0x2000,%sr		/*(Ëµ∞Ë°å„É¨„Éô„É´0)*/
0004f0 7201            168 	move.l	#1,%d1
0004f2 33FC E10C       169 	move.w	#0xE10C,USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ„Å´„Åó„Å¶Âæ©Â∏∞*/
       00FF F900       169 
0004fa 4CDF 0300       170 	movem.l	(%sp)+,%a0/%a1
0004fe 46FC 1000       171 	move.w #0x1000, %SR
000502 4E72 2700       172 	stop #0x2700
                       173 
                       174 
                       175 INQ:
                       176 	**	Áï™Âè∑no„ÅÆ„Ç≠„É•„Éº„Å´„Éá„Éº„Çø„Çí„ÅÑ„Çå„Çã
                       177 	**	ÂÖ•Âäõ no->d0.l	Êõ∏„ÅçËæº„ÇÄ8bitdata->d1.b
                       178 	**	Âá∫Âäõ Â§±Êïó0/ÊàêÂäü1 ->d0.l
000506 48E7 00C0       179 	movem.l	%a0/%a1,-(%sp)	/*Ëµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø*/
00050a 46FC 2700       180 	move.w 	#0x2700,%SR		/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
00050e 0C80 0000       181 	cmp.l 	#0,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå0*/
       0000            181 
000514 6700 0010       182 	beq	INQ0
000518 0C80 0000       183 	cmp.l 	#1,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå1*/
       0001            183 
00051e 6700 004A       184 	beq	INQ1
000522 4EFA 0132       185 	jmp	Queue_fail		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ*/
                       186 
                       187 	
                       188 INQ0:	
000526 0CB9 0000       189 	cmp.l	#256,s0
       0100 0000       189 
       0000            189 
000530 6700 0124       190 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
000534 2079 0000       191 	move.l	in0,%a0			
       0000            191 
00053a 1081            192 	move.b	%d1,(%a0)		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Å´Êõ∏„ÅçËæº„Åø*/
00053c 43F9 0000       193 	lea.l	bottom0,%a1
       0000            193 
000542 B1C9            194 	cmp.l	%a1,%a0
000544 6700 000C       195 	beq	INQ0_step1		/*in==bottom„ÅÆ„Å®„Åçin=top*/
000548 52B9 0000       196 	add.l	#1,in0			/*in++*/
       0000            196 
00054e 4EFA 000C       197 	jmp	INQ0_step2
                       198 
                       199 INQ0_step1:
000552 23F9 0000       200 	move.l top0,in0
       0000 0000       200 
       0000            200 
                       201 
                       202 INQ0_step2:
00055c 52B9 0000       203 	add.l	#1,s0 			/*s++*/
       0000            203 
000562 7001            204 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
000564 4CDF 0300       205 	movem.l (%sp)+,%a0/%a1		/*Ëµ∞Ë°å„É¨„Éô„É´„ÅÆÂõûÂæ©*/
000568 4E75            206 	rts
                       207 
                       208 INQ1:	
00056a 0CB9 0000       209 	cmp.l	#256,s1
       0100 0000       209 
       0000            209 
000574 6700 00E0       210 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
000578 2079 0000       211 	move.l	in1,%a0			
       0000            211 
00057e 1081            212 	move.b	%d1,(%a0)		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Å´Êõ∏„ÅçËæº„Åø*/
000580 43F9 0000       213 	lea.l	bottom1,%a1
       0000            213 
000586 B1C9            214 	cmp.l	%a1,%a0
000588 6700 000C       215 	beq	INQ1_step1		/*in==bottom„ÅÆ„Å®„Åçin=top*/
00058c 52B9 0000       216 	add.l	#1,in1			/*in++*/
       0000            216 
000592 4EFA 000C       217 	jmp	INQ1_step2
                       218 
                       219 INQ1_step1:
000596 23F9 0000       220 	move.l top1,in1
       0000 0000       220 
       0000            220 
                       221 
                       222 INQ1_step2:
0005a0 52B9 0000       223 	add.l	#1,s1 			/*s++*/
       0000            223 
0005a6 7001            224 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
0005a8 4CDF 0300       225 	movem.l (%sp)+,%a0/%a1		/*Ëµ∞Ë°å„É¨„Éô„É´„ÅÆÂõûÂæ©*/
0005ac 4E75            226 	rts
                       227 
                       228 
                       229 OUTQ:
                       230 	**	Áï™Âè∑no„ÅÆ„Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„Çí‰∏Ä„Å§Âèñ„ÇäÂá∫„Åô
                       231 	**	ÂÖ•Âäõ no->d0.l
                       232 	**	Âá∫Âäõ Â§±Êïó0/ÊàêÂäü1 ->d0.l		Âèñ„ÇäÂá∫„Åó„Åü8bitdata ->d1.b
0005ae 48E7 00C0       233 	movem.l	%a0/%a1,-(%sp)	/*Ëµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø*/
0005b2 46FC 2700       234 	move.w 	#0x2700,%SR		/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
0005b6 0C80 0000       235 	cmp.l 	#0,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå0*/
       0000            235 
0005bc 6700 0010       236 	beq	OUTQ0
0005c0 0C80 0000       237 	cmp.l 	#1,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå1*/
       0001            237 
0005c6 6700 004A       238 	beq	OUTQ1
0005ca 4EFA 008A       239 	jmp	Queue_fail		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ*/
                       240 	
                       241 
                       242 OUTQ0:	
0005ce 0CB9 0000       243 	cmp.l	#0,s0
       0000 0000       243 
       0000            243 
0005d8 6700 007C       244 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
0005dc 2079 0000       245 	move.l	out0,%a0			
       0000            245 
0005e2 1210            246 	move.b	(%a0),%d1		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Åã„ÇâÂèñ„ÇäÂá∫„Åó*/
0005e4 43F9 0000       247 	lea.l	bottom0,%a1
       0000            247 
0005ea B1C9            248 	cmp.l	%a1,%a0
0005ec 6700 000C       249 	beq	OUTQ0_step1		/*out==bottom„ÅÆ„Å®„Åçout=top*/
0005f0 52B9 0000       250 	add.l	#1,out0			/*out++*/
       0000            250 
0005f6 4EFA 000C       251 	jmp	OUTQ0_step2
                       252 
                       253 OUTQ0_step1:
0005fa 23F9 0000       254 	move.l top0,out0
       0000 0000       254 
       0000            254 
                       255 
                       256 OUTQ0_step2:
000604 53B9 0000       257 	sub.l	#1,s0 			/*s--*/
       0000            257 
00060a 7001            258 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
00060c 4CDF 0300       259 	movem.l (%sp)+,%a0/%a1		/*Ëµ∞Ë°å„É¨„Éô„É´„ÅÆÂõûÂæ©*/
000610 4E75            260 	rts
                       261 
                       262 OUTQ1:	
000612 0CB9 0000       263 	cmp.l	#0,s1
       0000 0000       263 
       0000            263 
00061c 6700 0038       264 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
000620 2079 0000       265 	move.l	out1,%a0			
       0000            265 
000626 1210            266 	move.b	(%a0),%d1		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Åã„ÇâÂèñ„ÇäÂá∫„Åó*/
000628 43F9 0000       267 	lea.l	bottom1,%a1
       0000            267 
00062e B1C9            268 	cmp.l	%a1,%a0
000630 6700 000C       269 	beq	OUTQ1_step1		/*out==bottom„ÅÆ„Å®„Åçout=top*/
000634 52B9 0000       270 	add.l	#1,out1			/*out++*/
       0000            270 
00063a 4EFA 000C       271 	jmp	OUTQ1_step2
                       272 
                       273 OUTQ1_step1:
00063e 23F9 0000       274 	move.l top1,out1
       0000 0000       274 
       0000            274 
                       275 
                       276 OUTQ1_step2:
000648 53B9 0000       277 	sub.l	#1,s1 			/*s--*/
       0000            277 
00064e 7001            278 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
000650 4CDF 0300       279 	movem.l (%sp)+,%a0/%a1		/*Ëµ∞Ë°å„É¨„Éô„É´„ÅÆÂõûÂæ©*/
000654 4E75            280 	rts
                       281 
                       282 	
                       283 Queue_fail:
000656 7000            284 	move.l #0,%d0			/*Â§±Êïó„ÅÆÂ†±Âëä*/
000658 4CDF 0300       285 	movem.l (%sp)+,%a0/%a1		/*Ëµ∞Ë°å„É¨„Éô„É´„ÅÆÂõûÂæ©*/
00065c 4E75            286 	rts
                       287 
                       288 /* INTERPUT(ch)„ÄÄ„ÉÅ„É£„É≥„Éç„É´ch„ÅÆÈÄÅ‰ø°„Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„Çí‰∏Ä„Å§Âèñ„ÇäÂá∫„ÅóÂÆüÈöõ„Å´È
                       289 ÂÖ•ÂäõÔºöch->%D1.l */
                       290 INTERPUT_PREPARE:
00065e 7200            291 	moveq #0,%d1
000660 4EFA 0002       292 	jmp INTERPUT
                       293 INTERPUT:
000664 46FC 2700       294 	move.w	#0x2700,%sr 	/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ÔºàËµ∞Ë°å„É¨„Éô„É´„ÇíÔºó„Å´Ë®≠ÂÆöÔºâ*/
000668 0C81 0000       295 	cmp.l 	#0,%d1
       0000            295 
00066e 6600 002E       296 	bne	INTERPUT_END		/*ch„Åå0„Åß„Å™„ÅÑ„Å™„Çâ‰Ωï„ÇÇ„Åõ„Åö„Å´Âæ©Â∏∞*/
000672 13FC 0031       297 	move.b #'1',LED0
       00D0 0039       297 
00067a 4EBA FF32       298 	jsr	OUTQ		/*data->%D1.b  %D0„Å´ÁµêÊûú„ÇíÊ†ºÁ¥ç*/|„Åì„Åì„ÅåÊÄ™„Åó„ÅÑ
00067e 0C80 0000       299 	cmp.l	#0,%d0
       0000            299 
000684 6700 0010       300 	beq	INTERPUT_fail
000688 0641 0800       301 	addi.w	#0x0800,%d1
00068c 33C1 00FF       302 	move.w	%d1,UTX1	/*Á¨¶Âè∑Êã°Âºµ„Åó„Å¶data„ÇíUTX1„Å´Ê†ºÁ¥ç*/
       F906            302 
                       303 		
000692 4EFA 000A       304 	jmp 	INTERPUT_END
                       305 INTERPUT_fail:
000696 33FC E108       306 	move.w	#0xE108,USTCNT1	/*OUTQ„ÅåÂ§±Êïó„Å™„ÇâÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢„Å´„Åó„Å¶Âæ©Â∏∞*/
       00FF F900       306 
                       307 INTERPUT_END:
00069e 4CDF FFFE       308 	movem.l (%sp)+,%a0-%a7/%d1-%d7
0006a2 4E73            309 	rte
                       310 	
                       311 	
                       312 sousin:
0006a4 48E7 7FFF       313 	movem.l %a0-%a7/%d1-%d7, -(%sp)
0006a8 33FC 0862       314 	move.w #0x0800+'b',UTX1
       00FF F906       314 
0006b0 4CDF FFFE       315 	movem.l (%sp)+,%a0-%a7/%d1-%d7
0006b4 4E73            316 	rte
                       317 HardwareInterface: 
0006b6 48E7 7FFF       318 	movem.l %a0-%a7/%d1-%d7, -(%sp)
0006ba 3239 00FF       319 	move.w UTX1,%d1
       F906            319 
0006c0 0241 8000       320 	andi.w #0x8000,%d1 
0006c4 0C41 8000       321 	cmp #0x8000,%d1
0006c8 6700 FF94       322 	beq INTERPUT_PREPARE
0006cc 4E73            323 	rte
                       324 
                       325 
                       326 .section .data
                       327 
0006d0 6162 6364       328 ABC:	.dc.b 'a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p',0
       6566 6768       328 
       696A 6B6C       328 
       6D6E 6F70       328 
       00              328 
                       329 .end
