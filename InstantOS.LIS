                         4 .list
                         5 ***************************************************************
                         6 ** ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 ***************************************************************
                         8 ***************
                         9 ** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        10 ***************
                        11 .equ REGBASE, 0xFFF000 | DMAP „Çí‰ΩøÁî®Ôºé
                        12 .equ IOBASE, 0x00d00000
                        13 ***************
                        14 ** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        15 ***************
                        16 .equ IVR, REGBASE+0x300 | Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        17 .equ IMR, REGBASE+0x304 | Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        18 .equ ISR, REGBASE+0x30c | Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        19 .equ IPR, REGBASE+0x310 | Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        20 ***************
                        21 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        22 ***************
                        23 .equ TCTL1, REGBASE+0x600 	| „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        24 .equ TPRER1, REGBASE+0x602  | „Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        25 .equ TCMP1, REGBASE+0x604 	| „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        26 .equ TCN1, REGBASE+0x608 	| „Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        27 .equ TSTAT1, REGBASE+0x60a 	| „Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        28 ***************
                        29 ** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        30 ***************
                        31 .equ USTCNT1, REGBASE+0x900 | UART1 „Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        32 .equ UBAUD1, REGBASE+0x902 	| UART1 „Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        33 .equ URX1, REGBASE+0x904 	| UART1 Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        34 .equ UTX1, REGBASE+0x906 	| UART1 ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        35 ***************
                        36 ** LED
                        37 ***************
                        38 .equ LED7, IOBASE+0x000002f | „Éú„Éº„ÉâÊê≠Ëºâ„ÅÆ LED Áî®„É¨„Ç∏„Çπ„Çø
                        39 .equ LED6, IOBASE+0x000002d | ‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤ A.4.3.1
                        40 .equ LED5, IOBASE+0x000002b
                        41 .equ LED4, IOBASE+0x0000029
                        42 .equ LED3, IOBASE+0x000003f
                        43 .equ LED2, IOBASE+0x000003d
                        44 .equ LED1, IOBASE+0x000003b
                        45 .equ LED0, IOBASE+0x0000039
                        46 **************
                        47 ** Êé®Â•®ÂÄ§
                        48 **************
                        49 .equ Mask_None,       0xFF3FFF
                        50 .equ Mask_UART1,      0xFF3FFB
                        51 .equ Mask_UART1_Timer,0xFF3FF9
                        52 **Timer
                        53 
                        54 **UART1
                        55 .equ U_Reset,   	  		0x0000
                        56 .equ U_Putpull,		  		0xE100
                        57 .equ U_Put_Interupt,  		0xE108
                        58 .equ U_PutPull_Interupt,	0xE10C
                        59 ***************************************************************
                        60 ** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        61 ***************************************************************
                        62 .section .bss
                        63 .even
000818 0000 0000        64 SYS_STK:.ds.b 0x4000 | „Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        64 
       0000 0000        64 
       0000 0000        64 
       0000 0000        64 
                        65 .even
                        66 SYS_STK_TOP: | „Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        67 *****************************************************************
                        68 **„Ç≠„É•„Éº
                        69 *****************************************************************
004818 0000 0000        70 top0:		.ds.b	255			/*„Ç≠„É•„Éº„ÅÆÊà¶Èóò„ÅÆÁï™Âú∞*/
       0000 0000        70 
       0000 0000        70 
       0000 0000        70 
       0000 0000        70 
004917 00               71 bottom0:	.ds.b	1			/*„Ç≠„É•„Éº„ÅÆÊú´Â∞æ„ÅÆÁï™Âú∞*/
004918 0000 0000        72 out0:		.ds.l	1			/*Ê¨°„Å´Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆ„ÅÇ„ÇãÁï™Âú∞*/
00491c 0000 0000        73 in0:		.ds.l	1 			/*Ê¨°„Å´„Éá„Éº„Çø„ÇíÂÖ•„Çå„Çã„Åπ„ÅçÁï™Âú∞*/
004920 0000 0000        74 s0:		.ds.l	1			/*„Ç≠„É•„Éº„Å´Ê∫ú„Åæ„Å£„Å¶„ÅÑ„Çã„Éá„Éº„Çø„ÅÆÊï∞*/
                        75 
004924 0000 0000        76 top1:		.ds.b	255			/*„Ç≠„É•„Éº„ÅÆÊà¶Èóò„ÅÆÁï™Âú∞*/
       0000 0000        76 
       0000 0000        76 
       0000 0000        76 
       0000 0000        76 
004a23 00               77 bottom1:	.ds.b	1			/*„Ç≠„É•„Éº„ÅÆÊú´Â∞æ„ÅÆÁï™Âú∞*/
004a24 0000 0000        78 out1:		.ds.l	1			/*Ê¨°„Å´Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆ„ÅÇ„ÇãÁï™Âú∞*/
004a28 0000 0000        79 in1:		.ds.l	1 			/*Ê¨°„Å´„Éá„Éº„Çø„ÇíÂÖ•„Çå„Çã„Åπ„ÅçÁï™Âú∞*/
004a2c 0000 0000        80 s1:		.ds.l	1			/*„Ç≠„É•„Éº„Å´Ê∫ú„Åæ„Å£„Å¶„ÅÑ„Çã„Éá„Éº„Çø„ÅÆÊï∞*/
                        81 
                        82 
                        83 .section .data
                        84 **putstring testÁî®„ÅÆ„Éá„Éº„Çø
                        85 
0007f8 3031 3233        86 TDATA1:		.ascii "0123456789ABCDEF"
       3435 3637        86 
       3839 4142        86 
       4344 4546        86 
000808 6B6C 6D6E        87 TDATA2:		.ascii "klmnopqrstuvwxyz"
       6F70 7172        87 
       7374 7576        87 
       7778 797A        87 
                        88 
                        89 
                        90 
                        91 
                        92 ***************************************************************
                        93 ** ÂàùÊúüÂåñ
                        94 ** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        95 ** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤ B „Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        96 ***************************************************************
                        97 .section .text
                        98 .even
                        99 boot: * „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂ & ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700       100 move.w #0x2700,%SR
000404 4FF9 0000       101 lea.l SYS_STK_TOP, %SP 			| Set SSP
       0000            101 
                       102 
                       103 ****************
                       104 ** Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                       105 ****************
00040a 13FC 0040       106 move.b #0x40, IVR 				| „É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí0x40+level „Å´Ë®≠ÂÆöÔºé
       00FF F300       106 
000412 21FC 0000       107 move.l #HardwareInterface ,0x110| ÈÄÅÂèó‰ø°Ââ≤Ëæº„Åø„ÇíË®≠ÂÆö
       0000 0110       107 
00041a 23FC 00FF       108 move.l #Mask_None,IMR 			| All Mask
       3FFF 00FF       108 
       F304            108 
                       109 
                       110 ****************
                       111 ** ÈÄÅÂèó‰ø° (UART1) Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ (Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ 4 „Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       112 ****************
000424 33FC 0000       113 move.w #U_Reset, USTCNT1 		| „É™„Çª„ÉÉ„Éà
       00FF F900       113 
00042c 33FC E100       114 move.w #U_Putpull, USTCNT1 	    |Âèó‰ø°ÈÄÅ‰ø°ÂèØËÉΩ
       00FF F900       114 
000434 33FC 0038       115 move.w #0x0038, UBAUD1 			| baud rate = 230400 bps
       00FF F902       115 
                       116 
                       117 ****************
                       118 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ (Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ 6 „Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       119 *****************
00043c 33FC 0004       120 move.w #0x0004, TCTL1 | restart, Ââ≤„ÇäËæº„Åø‰∏çÂèØ,
       00FF F600       120 
                       121 | „Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ 1/16 „ÇíÂçò‰Ωç„Å®„Åó„Å¶Ë®àÊôÇÔºåa
                       122 | „Çø„Ç§„Éû‰ΩøÁî®ÂÅúÊ≠¢
                       123 
                       124 *****************
                       125 **„Ç≠„É•„ÉºÂàùÊúüÂåñ
                       126 *****************
                       127 
000444 41F9 0000       128 lea.l	top0,%a0
       0000            128 
00044a 23C8 0000       129 move.l	%a0,in0
       0000            129 
000450 23C8 0000       130 move.l  %a0,out0
       0000            130 
000456 23FC 0000       131 move.l	#0,s0
       0000 0000       131 
       0000            131 
000460 41F9 0000       132 lea.l	top1,%a0
       0000            132 
000466 23C8 0000       133 move.l	%a0,in1
       0000            133 
00046c 23C8 0000       134 move.l  %a0,out1
       0000            134 
000472 23FC 0000       135 move.l	#0,s1
       0000 0000       135 
       0000            135 
00047c 6000 0002       136 bra MAIN
                       137 
                       138 MAIN:
                       139     **jsr Put
000480 46FC 2000       140     move.w #0x2000,%SR
                       141     **jmp	INQ_OUTQ_TEST
000484 23FC 00FF       142     move.l #Mask_UART1,IMR 			| All Mask
       3FFB 00FF       142 
       F304            142 
00048e 33FC E10C       143     move.w #U_PutPull_Interupt, USTCNT1 	    |Âèó‰ø°ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ
       00FF F900       143 
000496 33FC E108       144     move.w #0xE108,USTCNT1			|Âèó‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„ÅøË®±ÂèØ
       00FF F900       144 
00049e 4EBA 0050       145     jsr	PUTSTRING_TEST
0004a2 13FC 0053       146     move.b #'S',LED0
       00D0 0039       146 
                       147 Loop:
                       148 	**jmp HardwareInterface
0004aa 6000 FFFE       149 	bra Loop
                       150 
                       151 ********INTERPUT„ÅÆÂãï‰Ωú„ÉÜ„Çπ„Éà
                       152 ********„Ç≠„É•„Éº„Å´ÊñáÂ≠ó„ÇíÊ†ºÁ¥ç„Åô„Çã
                       153 Put:
0004ae 48E7 E000       154     movem.l %d0-%d2, -(%sp)
0004b2 123C 0061       155     move.b #0x61, %d1  |d0='a'
0004b6 143C 0010       156     move.b #16, %d2
                       157 PutLoop:
0004ba 7001            158     move.l #1,%d0
0004bc 4EBA 00D2       159     jsr INQ
0004c0 0C80 0000       160     cmpi.l #0,%d0
       0000            160 
0004c6 6700 0018       161     beq EndPut
0004ca 5302            162     subq.b #1 , %d2
0004cc 6700 0006       163     beq EndPutLoop
0004d0 6000 FFE8       164     bra PutLoop
                       165 EndPutLoop:
0004d4 0601 0001       166     addi.b #1,%d1
0004d8 143C 0010       167     move.b #16,%d2
0004dc 6000 FFDC       168     bra PutLoop
                       169 
                       170 EndPut:
0004e0 23FC 0000       171     move.l #256, s1
       0100 0000       171 
       0000            171 
0004ea 4CDF 0007       172     movem.l (%sp)+,%d0-%d2 
0004ee 4E75            173 	rts
                       174 
                       175 ********PUTSTRING„ÅÆÂãï‰Ωú„ÉÜ„Çπ„Éà
                       176 ********„Ç≠„É•„Éº„Å´ÊñáÂ≠ó„ÇíÊ†ºÁ¥ç„Åô„Çã
                       177 
                       178 PUTSTRING_TEST:
0004f0 7200            179 	move.l	#0,%d1
0004f2 45F9 0000       180 	lea.l 	TDATA1,%a2
       0000            180 
0004f8 240A            181 	move.l	%a2,%d2
0004fa 7610            182 	move.l 	#16,%d3
0004fc 4EBA 0258       183 	jsr	PUTSTRING
000500 283C 0000       184 	move.l	#1000,%d4
       03E8            184 
                       185 	
                       186 PUTSTRING_TEST_LOOP:
000506 5384            187 	sub.l	#1,%d4
000508 6700 0006       188 	beq	PUTSTRING_TEST2
00050c 4EFA FFF8       189 	jmp	PUTSTRING_TEST_LOOP
                       190 	
                       191 PUTSTRING_TEST2:
000510 7200            192 	move.l	#0,%d1
000512 45F9 0000       193 	lea.l 	TDATA2,%a2
       0000            193 
000518 240A            194 	move.l	%a2,%d2
00051a 7610            195 	move.l 	#16,%d3
00051c 4EBA 0238       196 	jsr	PUTSTRING
000520 283C 0000       197 	move.l	#1000,%d4
       03E8            197 
000526 4EFA 000A       198 	jmp	PUTSTRING_TEST_LOOP3
00052a 4EFA FFE4       199 	jmp	PUTSTRING_TEST2
                       200 	
                       201 PUTSTRING_TEST_LOOP2:
00052e 4EFA FFFE       202 	jmp	PUTSTRING_TEST_LOOP2
                       203 	
                       204 	**jmp	PUTSTRING_TEST2
                       205 	
                       206 PUTSTRING_TEST_LOOP3:
000532 5384            207 	sub.l	#1,%d4
000534 6700 FFDA       208 	beq	PUTSTRING_TEST2
000538 4EFA FFF8       209 	jmp	PUTSTRING_TEST_LOOP3
                       210 
                       211 **inq outq„Å¶„Åô„Å®
                       212 
                       213 
                       214 INQ_OUTQ_TEST:
00053c 4EBA 003E       215 	jsr 	INQ_INPUT
000540 4EBA 003A       216 	jsr 	INQ_INPUT
000544 4EBA 0036       217 	jsr 	INQ_INPUT
000548 4EBA 0032       218 	jsr 	INQ_INPUT
00054c 4EBA 002E       219 	jsr 	INQ_INPUT
000550 4EBA 002A       220 	jsr 	INQ_INPUT
000554 4EBA 0026       221 	jsr 	INQ_INPUT
000558 4EBA 0022       222 	jsr 	INQ_INPUT
00055c 4EBA 001E       223 	jsr 	INQ_INPUT
000560 4EBA 001A       224 	jsr 	INQ_INPUT
000564 4EBA 0022       225 	jsr 	OUTQ_INPUT
000568 4EBA 001E       226 	jsr 	OUTQ_INPUT
00056c 4EBA 001A       227 	jsr 	OUTQ_INPUT
000570 4EBA 0016       228 	jsr 	OUTQ_INPUT
000574 4EBA 0012       229 	jsr 	OUTQ_INPUT
000578 4EFA FFC2       230 	jmp	INQ_OUTQ_TEST
                       231 	
                       232 
                       233 INQ_INPUT:
00057c 7000            234 	move.l #0,%d0
00057e 123C 0061       235 	move.b #0x61,%d1
000582 4EBA 000C       236 	jsr INQ
000586 4E75            237 	rts
                       238 
                       239 OUTQ_INPUT:
000588 7000            240 	move.l #0,%d0
00058a 4EBA 00B6       241 	jsr OUTQ
00058e 4E75            242 	rts
                       243 	
                       244 
                       245 
                       246 INQ:
                       247 	**	Áï™Âè∑no„ÅÆ„Ç≠„É•„Éº„Å´„Éá„Éº„Çø„Çí„ÅÑ„Çå„Çã
                       248 	**	ÂÖ•Âäõ no->d0.l	Êõ∏„ÅçËæº„ÇÄ8bitdata->d1.b
                       249 	**	Âá∫Âäõ Â§±Êïó0/ÊàêÂäü1 ->d0.l
000590 48E7 20C0       250 	movem.l	%a0/%a1/%d2,-(%sp)	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Å´„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
000594 40E7            251 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
000596 46FC 2700       252 	move.w 	#0x2700,%SR			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
00059a 0C80 0000       253 	cmp.l 	#0,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå0*/
       0000            253 
0005a0 6700 0010       254 	beq	INQ0
0005a4 0C80 0000       255 	cmp.l 	#1,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå1*/
       0001            255 
0005aa 6700 004E       256 	beq	INQ1
0005ae 4EFA 0144       257 	jmp	Queue_fail		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ*/
                       258 
                       259 	
                       260 INQ0:	
0005b2 0CB9 0000       261 	cmp.l	#256,s0
       0100 0000       261 
       0000            261 
0005bc 6700 0136       262 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
0005c0 2079 0000       263 	move.l	in0,%a0			
       0000            263 
0005c6 1081            264 	move.b	%d1,(%a0)		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Å´Êõ∏„ÅçËæº„Åø*/
0005c8 43F9 0000       265 	lea.l	bottom0,%a1
       0000            265 
0005ce B1C9            266 	cmp.l	%a1,%a0
0005d0 6700 000C       267 	beq	INQ0_step1		/*in==bottom„ÅÆ„Å®„Åçin=top*/
0005d4 52B9 0000       268 	add.l	#1,in0			/*in++*/
       0000            268 
0005da 4EFA 000E       269 	jmp	INQ0_step2
                       270 
                       271 INQ0_step1:
0005de 41F9 0000       272 	lea.l	top0,%a0
       0000            272 
0005e4 23C8 0000       273 	move.l	%a0,in0
       0000            273 
                       274 	
                       275 
                       276 INQ0_step2:
0005ea 52B9 0000       277 	add.l	#1,s0 			/*s++*/
       0000            277 
0005f0 7001            278 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
0005f2 46DF            279 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0005f4 4CDF 0304       280 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
0005f8 4E75            281 	rts
                       282 
                       283 INQ1:	
0005fa 0CB9 0000       284 	cmp.l	#256,s1
       0100 0000       284 
       0000            284 
000604 6700 00EE       285 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
000608 2079 0000       286 	move.l	in1,%a0			
       0000            286 
00060e 1081            287 	move.b	%d1,(%a0)		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Å´Êõ∏„ÅçËæº„Åø*/
000610 43F9 0000       288 	lea.l	bottom1,%a1
       0000            288 
000616 B1C9            289 	cmp.l	%a1,%a0
000618 6700 000C       290 	beq	INQ1_step1		/*in==bottom„ÅÆ„Å®„Åçin=top*/
00061c 52B9 0000       291 	add.l	#1,in1			/*in++*/
       0000            291 
000622 4EFA 000E       292 	jmp	INQ1_step2
                       293 
                       294 INQ1_step1:
000626 41F9 0000       295 	lea.l	top1,%a0
       0000            295 
00062c 23C8 0000       296 	move.l	%a0,in1
       0000            296 
                       297 
                       298 INQ1_step2:
000632 52B9 0000       299 	add.l	#1,s1 			/*s++*/
       0000            299 
000638 7001            300 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
00063a 46DF            301 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
00063c 4CDF 0304       302 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
000640 4E75            303 	rts
                       304 
                       305 
                       306 OUTQ:
                       307 	**	Áï™Âè∑no„ÅÆ„Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„Çí‰∏Ä„Å§Âèñ„ÇäÂá∫„Åô
                       308 	**	ÂÖ•Âäõ „Ç≠„É•„Éº„ÅÆÁï™Âè∑->d0.l
                       309 	**	Âá∫Âäõ Â§±Êïó0/ÊàêÂäü1 ->d0.l		Âèñ„ÇäÂá∫„Åó„Åü8bitdata ->d1.b
000642 48E7 20C0       310 	movem.l	%a0/%a1/%d2,-(%sp)	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Å´„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
000646 40E7            311 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
000648 46FC 2700       312 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
00064c 0C80 0000       313 	cmp.l 	#0,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå0*/
       0000            313 
000652 6700 0010       314 	beq	OUTQ0
000656 0C80 0000       315 	cmp.l 	#1,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå1*/
       0001            315 
00065c 6700 004E       316 	beq	OUTQ1
000660 4EFA 0092       317 	jmp	Queue_fail		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ*/
                       318 	
                       319 
                       320 OUTQ0:	
000664 0CB9 0000       321 	cmp.l	#0,s0
       0000 0000       321 
       0000            321 
00066e 6700 0084       322 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
000672 2079 0000       323 	move.l	out0,%a0			
       0000            323 
000678 1210            324 	move.b	(%a0),%d1		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Åã„ÇâÂèñ„ÇäÂá∫„Åó*/
00067a 43F9 0000       325 	lea.l	bottom0,%a1
       0000            325 
000680 B1C9            326 	cmp.l	%a1,%a0
000682 6700 000C       327 	beq	OUTQ0_step1		/*out==bottom„ÅÆ„Å®„Åçout=top*/
000686 52B9 0000       328 	add.l	#1,out0			/*out++*/
       0000            328 
00068c 4EFA 000E       329 	jmp	OUTQ0_step2
                       330 
                       331 OUTQ0_step1:
000690 41F9 0000       332 	lea.l	top0,%a0
       0000            332 
000696 23C8 0000       333 	move.l	%a0,out0
       0000            333 
                       334 	
                       335 OUTQ0_step2:
00069c 53B9 0000       336 	sub.l	#1,s0 			/*s--*/
       0000            336 
0006a2 7001            337 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
0006a4 46DF            338 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0006a6 4CDF 0304       339 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
0006aa 4E75            340 	rts
                       341 
                       342 OUTQ1:	
0006ac 0CB9 0000       343 	cmp.l	#0,s1
       0000 0000       343 
       0000            343 
0006b6 6700 003C       344 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
0006ba 2079 0000       345 	move.l	out1,%a0			
       0000            345 
0006c0 1210            346 	move.b	(%a0),%d1		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Åã„ÇâÂèñ„ÇäÂá∫„Åó*/
0006c2 43F9 0000       347 	lea.l	bottom1,%a1
       0000            347 
0006c8 B1C9            348 	cmp.l	%a1,%a0
0006ca 6700 000C       349 	beq	OUTQ1_step1		/*out==bottom„ÅÆ„Å®„Åçout=top*/
0006ce 52B9 0000       350 	add.l	#1,out1			/*out++*/
       0000            350 
0006d4 4EFA 000E       351 	jmp	OUTQ1_step2
                       352 
                       353 OUTQ1_step1:
0006d8 41F9 0000       354 	lea.l	top1,%a0
       0000            354 
0006de 23C8 0000       355 	move.l	%a0,in1
       0000            355 
                       356 
                       357 OUTQ1_step2:
0006e4 53B9 0000       358 	sub.l	#1,s1 			/*s--*/
       0000            358 
0006ea 7001            359 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
0006ec 46DF            360 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0006ee 4CDF 0304       361 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
0006f2 4E75            362 	rts
                       363 
                       364 	
                       365 Queue_fail:
0006f4 7000            366 	move.l #0,%d0			/*Â§±Êïó„ÅÆÂ†±Âëä*/
0006f6 46DF            367 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0006f8 4CDF 0304       368 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
0006fc 4E75            369 	rts
                       370 
                       371 INTERGET:
0006fe 13FC 0031       372 	move.b #'1',LED7
       00D0 002F       372 
000706 4E75            373 	rts
                       374 	
                       375 /* INTERPUT(ch)„ÄÄ„ÉÅ„É£„É≥„Éç„É´ch„ÅÆÈÄÅ‰ø°„Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„Çí‰∏Ä„Å§Âèñ„ÇäÂá∫„ÅóÂÆüÈöõ„Å´È
                       376 ÂÖ•ÂäõÔºöch->%D1.l */
                       377 INTERPUT:
000708 13FC 0049       378 	move.b #'I',LED2
       00D0 003D       378 
000710 40E7            379 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
000712 46FC 2700       380 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
000716 0C81 0000       381 	cmp.l 	#0,%d1
       0000            381 
00071c 6600 0034       382 	bne	INTERPUT_END		/*ch„Åå0„Åß„Å™„ÅÑ„Å™„Çâ‰Ωï„ÇÇ„Åõ„Åö„Å´Âæ©Â∏∞*/
000720 7001            383     	move.l #1 , %d0          /* „Ç≠„É•„Éº1„ÇíÈÅ∏Êäû */
000722 4EBA FF1E       384 	jsr	OUTQ		        /*data->%D1.b  %D0„Å´ÁµêÊûú„ÇíÊ†ºÁ¥ç*/
000726 0C80 0000       385 	cmp.l	#0,%d0
       0000            385 
00072c 6700 0010       386 	beq	INTERPUT_fail
000730 0641 0800       387 	add.w	#0x0800,%d1
000734 33C1 00FF       388 	move.w	%d1,UTX1	/*Á¨¶Âè∑Êã°Âºµ„Åó„Å¶data„ÇíUTX1„Å´Ê†ºÁ¥ç*/
       F906            388 
00073a 4EFA 0016       389 	jmp 	INTERPUT_END
                       390 INTERPUT_fail:
00073e 13FC 0046       391 	move.b #'F',LED3
       00D0 003F       391 
000746 33FC E108       392 	move.w	#U_Put_Interupt,USTCNT1	/*OUTQ„ÅåÂ§±Êïó„Å™„ÇâÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢„Å´„Åó„Å¶Âæ©Â∏∞*/
       00FF F900       392 
00074e 46DF            393 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000750 4E75            394 	rts
                       395 INTERPUT_END:
000752 46DF            396 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000754 4E75            397 	rts
                       398 
                       399 ******************************************************************************
                       400 ** PUTSTRING(ch, p, size)
                       401 **ch„ÅÆÈÄÅ‰ø°„Ç≠„É•„Éº„Å´pÁï™Âú∞„Åã„ÇâÂßã„Åæ„Çãsize„Éê„Ç§„Éà„ÅÆ„Éá„Éº„Çø„ÇíÊ†ºÁ¥ç„Åó„ÄÅÈÄÅ‰ø°Ââ≤„Çä
                       402 **ÂÖ•ÂäõÔºö ch->%d1.l  p->%d2.l  size->%d3.l
                       403 **Êàª„ÇäÂÄ§ÔºöÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞ sz->d0.l
                       404 ******************************************************************************
                       405 PUTSTRING:
000756 48E7 0880       406 	movem.l	%a0/%d4,-(%sp)
00075a 40E7            407 	move.w 	%sr,-(%sp)			/*Ëµ∞Ë°å„É¨„Éô„É´ÈÄÄÈÅø*/
00075c 46FC 2700       408 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
                       409 	
000760 0C81 0000       410 	cmp.l	#0,%d1
       0000            410 
000766 6600 0038       411 	bne	PUTSTRING_END 	/*ch‚â†0„Å™„Çâ‰Ωï„ÇÇ„Åõ„ÅöÂæ©Â∏∞*/
                       412 
00076a 7800            413 	move.l	#0,%d4		/*sz->%d4*/
00076c 2042            414 	movea.l %d2,%a0 	/*i->a0*/ 
                       415 	
00076e 0C83 0000       416 	cmp.l	#0,%d3
       0000            416 
000774 6700 0028       417 	beq	PUTSTRING_STEP2 /*size=0„Å™„ÇâÂàÜÂ≤ê*/
                       418 	
                       419 PUTSTRING_LOOP:
000778 B684            420 	cmp.l	%d4,%d3
00077a 6700 001A       421 	beq	PUTSTRING_STEP1 /*sz=size„Å™„ÇâÂàÜÂ≤ê*/
                       422 
00077e 7001            423 	move.l	#1,%d0
000780 1218            424 	move.b 	(%a0)+,%d1
000782 4EBA FE0C       425 	jsr	INQ 		/*INQ(no->d0.l,data->d1.b)*/
                       426 
000786 0C80 0000       427 	cmp.l	#0,%d0
       0000            427 
00078c 6700 0008       428 	beq	PUTSTRING_STEP1 /*INQ„ÅåÂ§±Êïó„Å™„ÇâÂàÜÂ≤ê*/
                       429 
000790 5284            430 	addq.l	#1,%d4		/*sz++*/
000792 6000 FFE4       431 	bra	PUTSTRING_LOOP 
                       432 	
                       433 PUTSTRING_STEP1:
000796 33FC E10C       434 	move.w	#0xE10C,USTCNT1 /*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       434 
                       435 		
                       436 PUTSTRING_STEP2:
00079e 2004            437 	move.l %d4,%d0
                       438 
                       439 PUTSTRING_END:
0007a0 46DF            440 	move.w  (%sp)+, %sr			/*Ëµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0007a2 4CDF 0110       441 	movem.l	(%sp)+,%a0/%d4
0007a6 4E75            442 	rts
                       443 	
                       444 
                       445 HardwareInterface: 
0007a8 13FC 0048       446 	move.b #'H',LED1
       00D0 003B       446 
0007b0 48E7 7FFF       447 	movem.l %a0-%a7/%d1-%d7, -(%sp)
0007b4 3639 00FF       448 	move.w URX1,%d3
       F904            448 
0007ba 1403            449 	move.b %d3,%d2 /* data = %d2.b */
0007bc 0243 2000       450 	andi.w #0x2000,%d3
0007c0 0C43 2000       451 	cmpi.w #0x2000,%d3 /* URX1„ÅÆ13bitÁõÆ„Åå1„ÅÆÂ†¥ÂêàINTERGETÂëº„Å≥Âá∫„Åó */
0007c4 6700 001A       452 	beq INTERGET_PREPARE
0007c8 3239 00FF       453 	move.w UTX1,%d1
       F906            453 
                       454 	**move #0x8000,%d1
0007ce 0241 8000       455 	and.w #0x8000,%d1 
0007d2 0C41 8000       456 	cmp #0x8000,%d1
0007d6 6700 0014       457 	beq INTERPUT_PREPARE
0007da 4CDF FFFE       458         movem.l (%sp)+,%a0-%a7/%d1-%d7 
0007de 4E73            459 	rte
                       460 INTERGET_PREPARE:
0007e0 7200            461 	moveq.l #0,%d1 /* ch = %d1.l = 0 */
0007e2 4EBA FF1A       462 	jsr INTERGET
0007e6 4CDF FFFE       463     	movem.l (%sp)+,%a0-%a7/%d1-%d7
0007ea 4E73            464     	rte
                       465 INTERPUT_PREPARE:
0007ec 7200            466     	move.l #0, %d1
0007ee 4EBA FF18       467     	jsr INTERPUT
0007f2 4CDF FFFE       468     	movem.l (%sp)+,%a0-%a7/%d1-%d7
0007f6 4E73            469     	rte
                       470 .end
