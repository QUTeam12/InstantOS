                         4 .list
                         5 ***************************************************************
                         6 ** ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 ***************************************************************
                         8 ***************
                         9 ** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        10 ***************
                        11 .equ REGBASE, 0xFFF000 | DMAP „Çí‰ΩøÁî®Ôºé
                        12 .equ IOBASE, 0x00d00000
                        13 ***************
                        14 ** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        15 ***************
                        16 .equ IVR, REGBASE+0x300 | Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        17 .equ IMR, REGBASE+0x304 | Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        18 .equ ISR, REGBASE+0x30c | Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        19 .equ IPR, REGBASE+0x310 | Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        20 ***************
                        21 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        22 ***************
                        23 .equ TCTL1, REGBASE+0x600 	| „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        24 .equ TPRER1, REGBASE+0x602  | „Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        25 .equ TCMP1, REGBASE+0x604 	| „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        26 .equ TCN1, REGBASE+0x608 	| „Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        27 .equ TSTAT1, REGBASE+0x60a 	| „Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        28 ***************
                        29 ** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        30 ***************
                        31 .equ USTCNT1, REGBASE+0x900 | UART1 „Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        32 .equ UBAUD1, REGBASE+0x902 	| UART1 „Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        33 .equ URX1, REGBASE+0x904 	| UART1 Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        34 .equ UTX1, REGBASE+0x906 	| UART1 ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        35 ***************
                        36 ** LED
                        37 ***************
                        38 .equ LED7, IOBASE+0x000002f | „Éú„Éº„ÉâÊê≠Ëºâ„ÅÆ LED Áî®„É¨„Ç∏„Çπ„Çø
                        39 .equ LED6, IOBASE+0x000002d | ‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤ A.4.3.1
                        40 .equ LED5, IOBASE+0x000002b
                        41 .equ LED4, IOBASE+0x0000029
                        42 .equ LED3, IOBASE+0x000003f
                        43 .equ LED2, IOBASE+0x000003d
                        44 .equ LED1, IOBASE+0x000003b
                        45 .equ LED0, IOBASE+0x0000039
                        46 **************
                        47 ** Êé®Â•®ÂÄ§
                        48 **************
                        49 .equ Mask_None,       0xFF3FFF
                        50 .equ Mask_UART1,      0xFF3FFB
                        51 .equ Mask_UART1_Timer,0xFF3FF9
                        52 **Timer
                        53 
                        54 **UART1
                        55 .equ U_Reset,   	  		0x0000
                        56 .equ U_Putpull,		  		0xE100
                        57 .equ U_Put_Interupt,  		0xE108
                        58 .equ U_PutPull_Interupt,	0xE10C
                        59 ***************************************************************
                        60 ** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        61 ***************************************************************
                        62 .section .bss
                        63 .even
00088c 0000 0000        64 task_p: .ds.l	1
                        65 .even
000890 0000 0000        66 SYS_STK:.ds.b 0x4000 | „Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        66 
       0000 0000        66 
       0000 0000        66 
       0000 0000        66 
                        67 .even
                        68 SYS_STK_TOP: | „Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        69 *****************************************************************
                        70 **„Ç≠„É•„Éº
                        71 *****************************************************************
004890 0000 0000        72 top0:		.ds.b	255			/*„Ç≠„É•„Éº„ÅÆÊà¶Èóò„ÅÆÁï™Âú∞*/
       0000 0000        72 
       0000 0000        72 
       0000 0000        72 
       0000 0000        72 
00498f 00               73 bottom0:	.ds.b	1			/*„Ç≠„É•„Éº„ÅÆÊú´Â∞æ„ÅÆÁï™Âú∞*/
004990 0000 0000        74 out0:		.ds.l	1			/*Ê¨°„Å´Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆ„ÅÇ„ÇãÁï™Âú∞*/
004994 0000 0000        75 in0:		.ds.l	1 			/*Ê¨°„Å´„Éá„Éº„Çø„ÇíÂÖ•„Çå„Çã„Åπ„ÅçÁï™Âú∞*/
004998 0000 0000        76 s0:		.ds.l	1			/*„Ç≠„É•„Éº„Å´Ê∫ú„Åæ„Å£„Å¶„ÅÑ„Çã„Éá„Éº„Çø„ÅÆÊï∞*/
                        77 
00499c 0000 0000        78 top1:		.ds.b	255			/*„Ç≠„É•„Éº„ÅÆÊà¶Èóò„ÅÆÁï™Âú∞*/
       0000 0000        78 
       0000 0000        78 
       0000 0000        78 
       0000 0000        78 
004a9b 00               79 bottom1:	.ds.b	1			/*„Ç≠„É•„Éº„ÅÆÊú´Â∞æ„ÅÆÁï™Âú∞*/
004a9c 0000 0000        80 out1:		.ds.l	1			/*Ê¨°„Å´Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆ„ÅÇ„ÇãÁï™Âú∞*/
004aa0 0000 0000        81 in1:		.ds.l	1 			/*Ê¨°„Å´„Éá„Éº„Çø„ÇíÂÖ•„Çå„Çã„Åπ„ÅçÁï™Âú∞*/
004aa4 0000 0000        82 s1:		.ds.l	1			/*„Ç≠„É•„Éº„Å´Ê∫ú„Åæ„Å£„Å¶„ÅÑ„Çã„Éá„Éº„Çø„ÅÆÊï∞*/
                        83 
                        84 
                        85 .section .data
                        86 **putstring testÁî®„ÅÆ„Éá„Éº„Çø
                        87 
00086c 3031 3233        88 TDATA1:		.ascii "0123456789ABCDEF"
       3435 3637        88 
       3839 4142        88 
       4344 4546        88 
00087c 6B6C 6D6E        89 TDATA2:		.ascii "klmnopqrstuvwxyz"
       6F70 7172        89 
       7374 7576        89 
       7778 797A        89 
                        90 
                        91 
                        92 
                        93 
                        94 ***************************************************************
                        95 ** ÂàùÊúüÂåñ
                        96 ** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        97 ** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤ B „Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        98 ***************************************************************
                        99 .section .text
                       100 .even
                       101 boot: * „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂ & ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700       102 move.w #0x2700,%SR
000404 4FF9 0000       103 lea.l SYS_STK_TOP, %SP 			| Set SSP
       0000            103 
                       104 
                       105 ****************
                       106 ** Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                       107 ****************
00040a 13FC 0040       108 move.b #0x40, IVR 				| „É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí0x40+level „Å´Ë®≠ÂÆöÔºé
       00FF F300       108 
000412 21FC 0000       109 move.l #HardwareInterface ,0x110| ÈÄÅÂèó‰ø°Ââ≤Ëæº„Åø„ÇíË®≠ÂÆö
       0000 0110       109 
00041a 21FC 0000       110 move.l #TimerInterface, 0x118 | „Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„ÅÆË®≠ÂÆö
       0000 0118       110 
000422 23FC 00FF       111 move.l #Mask_None,IMR 			| All Mask
       3FFF 00FF       111 
       F304            111 
                       112 
                       113 ****************
                       114 ** ÈÄÅÂèó‰ø° (UART1) Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ (Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ 4 „Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       115 ****************
00042c 33FC 0000       116 move.w #U_Reset, USTCNT1 		| „É™„Çª„ÉÉ„Éà
       00FF F900       116 
000434 33FC E100       117 move.w #U_Putpull, USTCNT1 	    |Âèó‰ø°ÈÄÅ‰ø°ÂèØËÉΩ
       00FF F900       117 
00043c 33FC 0038       118 move.w #0x0038, UBAUD1 			| baud rate = 230400 bps
       00FF F902       118 
                       119 
                       120 ****************
                       121 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ (Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ 6 „Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       122 ** RESET_TIMER()  TCTL1„ÇíË®≠ÂÆö
                       123 ** ÂÖ•Âäõ„ÄÅÊàª„ÇäÂÄ§„Å™„Åó
                       124 *****************
000444 33FC 0004       125 move.w #0x0004, TCTL1 | restart, Ââ≤„ÇäËæº„Åø‰∏çÂèØ,
       00FF F600       125 
                       126 | „Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ 1/16 „ÇíÂçò‰Ωç„Å®„Åó„Å¶Ë®àÊôÇ,
                       127 | „Çø„Ç§„Éû‰ΩøÁî®ÂÅúÊ≠¢
                       128 
                       129 ******************
                       130 ** SET_TIMER(t, p)
                       131 ** ÂÖ•Âäõ:Ââ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúüd1.w
                       132 **      Ââ≤„ÇäËæº„ÅøÊôÇ„Å´Ëµ∑Âãï„Åô„Çã„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπd2.l
                       133 ** Êàª„ÇäÂÄ§„Å™„Åó
                       134 ******************
                       135 /* TODO: „É¨„Ç∏„Çπ„Çø„ÅÆÁÆ°ÁêÜ„ÄÇ„É¨„Ç∏„Çπ„ÇøÂ§âÊõ¥‰∫àÂÆö„ÄÇ*/
                       136 SET_TIMER:
                       137 	** lea.l   task_p, %a0 /* TODO: step9„Åæ„Åß„ÅäÈ†ê„Åë */
                       138 	** move.l  %d2, (%a0) |task_p=ÂÖ•Âäõd2 /* TODO: step9„Åæ„Åß„ÅäÈ†ê„Åë */
00044c 33FC 00CE       139 	move.w  #0xce, TPRER1 |1„Ç´„Ç¶„É≥„Éà0.1msec„Å´Ë®≠ÂÆö
       00FF F602       139 
000454 323C C350       140 	move.w  #0xc350, %d1 /* „Çø„Ç§„ÉûÈñìÈöî„ÅÆ„ÉÜ„Çπ„ÉàÂÄ§„ÄÇ5sec„ÄÇ*/
000458 33C1 00FF       141 	move.w  %d1, TCMP1 |Ââ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü„ÇíË®≠ÂÆö
       F604            141 
00045e 33FC 0015       142 	move.w  #0x15, TCTL1 |„Çø„Ç§„Éû‰ΩøÁî®Ë®±ÂèØ
       00FF F600       142 
                       143 
                       144 *****************
                       145 **„Ç≠„É•„ÉºÂàùÊúüÂåñ
                       146 *****************
                       147 
000466 41F9 0000       148 lea.l	top0,%a0
       0000            148 
00046c 23C8 0000       149 move.l	%a0,in0
       0000            149 
000472 23C8 0000       150 move.l  %a0,out0
       0000            150 
000478 23FC 0000       151 move.l	#0,s0
       0000 0000       151 
       0000            151 
000482 41F9 0000       152 lea.l	top1,%a0
       0000            152 
000488 23C8 0000       153 move.l	%a0,in1
       0000            153 
00048e 23C8 0000       154 move.l  %a0,out1
       0000            154 
000494 23FC 0000       155 move.l	#0,s1
       0000 0000       155 
       0000            155 
00049e 6000 0002       156 bra MAIN
                       157 
                       158 *****************
                       159 **„É´„Éº„Éó
                       160 *****************
                       161 MAIN:
                       162     **jsr Put
0004a2 46FC 2000       163     move.w #0x2000,%SR /* Ââ≤„ÇäËæº„ÅøË®±ÂèØÔºé(„Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂„É¢„Éº„Éâ„ÅÆÂ†¥Âêà) */
                       164     **jmp	INQ_OUTQ_TEST
0004a6 23FC 00FF       165     move.l #Mask_UART1_Timer,IMR 			| All Mask(„Çø„Ç§„Éû„ÇÇË®±ÂèØ)
       3FF9 00FF       165 
       F304            165 
0004b0 33FC E10C       166     move.w #U_PutPull_Interupt, USTCNT1 	    |Âèó‰ø°ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ
       00FF F900       166 
0004b8 33FC E108       167     move.w #0xE108,USTCNT1			|Âèó‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„ÅøË®±ÂèØ
       00FF F900       167 
0004c0 4EBA 0050       168     jsr	PUTSTRING_TEST
0004c4 13FC 0053       169     move.b #'S',LED0
       00D0 0039       169 
                       170 Loop:
                       171 	**jmp HardwareInterface /* „Ç∑„Éü„É•„É¨„Éº„Çø„ÉÜ„Çπ„ÉàÁî® */
0004cc 6000 FFFE       172 	bra Loop
                       173 
                       174 ********INTERPUT„ÅÆÂãï‰Ωú„ÉÜ„Çπ„Éà
                       175 ********„Ç≠„É•„Éº„Å´ÊñáÂ≠ó„ÇíÊ†ºÁ¥ç„Åô„Çã
                       176 Put:
0004d0 48E7 E000       177     movem.l %d0-%d2, -(%sp)
0004d4 123C 0061       178     move.b #0x61, %d1  |d0='a'
0004d8 143C 0010       179     move.b #16, %d2
                       180 PutLoop:
0004dc 7001            181     move.l #1,%d0
0004de 4EBA 00D2       182     jsr INQ
0004e2 0C80 0000       183     cmpi.l #0,%d0
       0000            183 
0004e8 6700 0018       184     beq EndPut
0004ec 5302            185     subq.b #1 , %d2
0004ee 6700 0006       186     beq EndPutLoop
0004f2 6000 FFE8       187     bra PutLoop
                       188 EndPutLoop:
0004f6 0601 0001       189     addi.b #1,%d1
0004fa 143C 0010       190     move.b #16,%d2
0004fe 6000 FFDC       191     bra PutLoop
                       192 
                       193 EndPut:
000502 23FC 0000       194     move.l #256, s1
       0100 0000       194 
       0000            194 
00050c 4CDF 0007       195     movem.l (%sp)+,%d0-%d2 
000510 4E75            196 	rts
                       197 
                       198 ********PUTSTRING„ÅÆÂãï‰Ωú„ÉÜ„Çπ„Éà
                       199 ********„Ç≠„É•„Éº„Å´ÊñáÂ≠ó„ÇíÊ†ºÁ¥ç„Åô„Çã
                       200 
                       201 PUTSTRING_TEST:
000512 7200            202 	move.l	#0,%d1
000514 45F9 0000       203 	lea.l 	TDATA1,%a2
       0000            203 
00051a 240A            204 	move.l	%a2,%d2
00051c 7610            205 	move.l 	#16,%d3
00051e 4EBA 0258       206 	jsr	PUTSTRING
000522 283C 0000       207 	move.l	#1000,%d4
       03E8            207 
                       208 	
                       209 PUTSTRING_TEST_LOOP:
000528 5384            210 	sub.l	#1,%d4
00052a 6700 0006       211 	beq	PUTSTRING_TEST2
00052e 4EFA FFF8       212 	jmp	PUTSTRING_TEST_LOOP
                       213 	
                       214 PUTSTRING_TEST2:
000532 7200            215 	move.l	#0,%d1
000534 45F9 0000       216 	lea.l 	TDATA2,%a2
       0000            216 
00053a 240A            217 	move.l	%a2,%d2
00053c 7610            218 	move.l 	#16,%d3
00053e 4EBA 0238       219 	jsr	PUTSTRING
000542 283C 0000       220 	move.l	#1000,%d4
       03E8            220 
000548 4EFA 000A       221 	jmp	PUTSTRING_TEST_LOOP3
00054c 4EFA FFE4       222 	jmp	PUTSTRING_TEST2
                       223 	
                       224 PUTSTRING_TEST_LOOP2:
000550 4EFA FFFE       225 	jmp	PUTSTRING_TEST_LOOP2
                       226 	
                       227 	**jmp	PUTSTRING_TEST2
                       228 	
                       229 PUTSTRING_TEST_LOOP3:
000554 5384            230 	sub.l	#1,%d4
000556 6700 FFDA       231 	beq	PUTSTRING_TEST2
00055a 4EFA FFF8       232 	jmp	PUTSTRING_TEST_LOOP3
                       233 
                       234 **inq outq„Å¶„Åô„Å®
                       235 
                       236 
                       237 INQ_OUTQ_TEST:
00055e 4EBA 003E       238 	jsr 	INQ_INPUT
000562 4EBA 003A       239 	jsr 	INQ_INPUT
000566 4EBA 0036       240 	jsr 	INQ_INPUT
00056a 4EBA 0032       241 	jsr 	INQ_INPUT
00056e 4EBA 002E       242 	jsr 	INQ_INPUT
000572 4EBA 002A       243 	jsr 	INQ_INPUT
000576 4EBA 0026       244 	jsr 	INQ_INPUT
00057a 4EBA 0022       245 	jsr 	INQ_INPUT
00057e 4EBA 001E       246 	jsr 	INQ_INPUT
000582 4EBA 001A       247 	jsr 	INQ_INPUT
000586 4EBA 0022       248 	jsr 	OUTQ_INPUT
00058a 4EBA 001E       249 	jsr 	OUTQ_INPUT
00058e 4EBA 001A       250 	jsr 	OUTQ_INPUT
000592 4EBA 0016       251 	jsr 	OUTQ_INPUT
000596 4EBA 0012       252 	jsr 	OUTQ_INPUT
00059a 4EFA FFC2       253 	jmp	INQ_OUTQ_TEST
                       254 	
                       255 
                       256 INQ_INPUT:
00059e 7000            257 	move.l #0,%d0
0005a0 123C 0061       258 	move.b #0x61,%d1
0005a4 4EBA 000C       259 	jsr INQ
0005a8 4E75            260 	rts
                       261 
                       262 OUTQ_INPUT:
0005aa 7000            263 	move.l #0,%d0
0005ac 4EBA 00B6       264 	jsr OUTQ
0005b0 4E75            265 	rts
                       266 	
                       267 
                       268 
                       269 INQ:
                       270 	**	Áï™Âè∑no„ÅÆ„Ç≠„É•„Éº„Å´„Éá„Éº„Çø„Çí„ÅÑ„Çå„Çã
                       271 	**	ÂÖ•Âäõ no->d0.l	Êõ∏„ÅçËæº„ÇÄ8bitdata->d1.b
                       272 	**	Âá∫Âäõ Â§±Êïó0/ÊàêÂäü1 ->d0.l
0005b2 48E7 20C0       273 	movem.l	%a0/%a1/%d2,-(%sp)	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Å´„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
0005b6 40E7            274 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
0005b8 46FC 2700       275 	move.w 	#0x2700,%SR			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
0005bc 0C80 0000       276 	cmp.l 	#0,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå0*/
       0000            276 
0005c2 6700 0010       277 	beq	INQ0
0005c6 0C80 0000       278 	cmp.l 	#1,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå1*/
       0001            278 
0005cc 6700 004E       279 	beq	INQ1
0005d0 4EFA 0144       280 	jmp	Queue_fail		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ*/
                       281 
                       282 	
                       283 INQ0:	
0005d4 0CB9 0000       284 	cmp.l	#256,s0
       0100 0000       284 
       0000            284 
0005de 6700 0136       285 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
0005e2 2079 0000       286 	move.l	in0,%a0			
       0000            286 
0005e8 1081            287 	move.b	%d1,(%a0)		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Å´Êõ∏„ÅçËæº„Åø*/
0005ea 43F9 0000       288 	lea.l	bottom0,%a1
       0000            288 
0005f0 B1C9            289 	cmp.l	%a1,%a0
0005f2 6700 000C       290 	beq	INQ0_step1		/*in==bottom„ÅÆ„Å®„Åçin=top*/
0005f6 52B9 0000       291 	add.l	#1,in0			/*in++*/
       0000            291 
0005fc 4EFA 000E       292 	jmp	INQ0_step2
                       293 
                       294 INQ0_step1:
000600 41F9 0000       295 	lea.l	top0,%a0
       0000            295 
000606 23C8 0000       296 	move.l	%a0,in0
       0000            296 
                       297 	
                       298 
                       299 INQ0_step2:
00060c 52B9 0000       300 	add.l	#1,s0 			/*s++*/
       0000            300 
000612 7001            301 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
000614 46DF            302 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000616 4CDF 0304       303 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
00061a 4E75            304 	rts
                       305 
                       306 INQ1:	
00061c 0CB9 0000       307 	cmp.l	#256,s1
       0100 0000       307 
       0000            307 
000626 6700 00EE       308 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
00062a 2079 0000       309 	move.l	in1,%a0			
       0000            309 
000630 1081            310 	move.b	%d1,(%a0)		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Å´Êõ∏„ÅçËæº„Åø*/
000632 43F9 0000       311 	lea.l	bottom1,%a1
       0000            311 
000638 B1C9            312 	cmp.l	%a1,%a0
00063a 6700 000C       313 	beq	INQ1_step1		/*in==bottom„ÅÆ„Å®„Åçin=top*/
00063e 52B9 0000       314 	add.l	#1,in1			/*in++*/
       0000            314 
000644 4EFA 000E       315 	jmp	INQ1_step2
                       316 
                       317 INQ1_step1:
000648 41F9 0000       318 	lea.l	top1,%a0
       0000            318 
00064e 23C8 0000       319 	move.l	%a0,in1
       0000            319 
                       320 
                       321 INQ1_step2:
000654 52B9 0000       322 	add.l	#1,s1 			/*s++*/
       0000            322 
00065a 7001            323 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
00065c 46DF            324 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
00065e 4CDF 0304       325 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
000662 4E75            326 	rts
                       327 
                       328 
                       329 OUTQ:
                       330 	**	Áï™Âè∑no„ÅÆ„Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„Çí‰∏Ä„Å§Âèñ„ÇäÂá∫„Åô
                       331 	**	ÂÖ•Âäõ „Ç≠„É•„Éº„ÅÆÁï™Âè∑->d0.l
                       332 	**	Âá∫Âäõ Â§±Êïó0/ÊàêÂäü1 ->d0.l		Âèñ„ÇäÂá∫„Åó„Åü8bitdata ->d1.b
000664 48E7 20C0       333 	movem.l	%a0/%a1/%d2,-(%sp)	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Å´„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
000668 40E7            334 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
00066a 46FC 2700       335 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
00066e 0C80 0000       336 	cmp.l 	#0,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå0*/
       0000            336 
000674 6700 0010       337 	beq	OUTQ0
000678 0C80 0000       338 	cmp.l 	#1,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå1*/
       0001            338 
00067e 6700 004E       339 	beq	OUTQ1
000682 4EFA 0092       340 	jmp	Queue_fail		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ*/
                       341 	
                       342 
                       343 OUTQ0:	
000686 0CB9 0000       344 	cmp.l	#0,s0
       0000 0000       344 
       0000            344 
000690 6700 0084       345 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
000694 2079 0000       346 	move.l	out0,%a0			
       0000            346 
00069a 1210            347 	move.b	(%a0),%d1		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Åã„ÇâÂèñ„ÇäÂá∫„Åó*/
00069c 43F9 0000       348 	lea.l	bottom0,%a1
       0000            348 
0006a2 B1C9            349 	cmp.l	%a1,%a0
0006a4 6700 000C       350 	beq	OUTQ0_step1		/*out==bottom„ÅÆ„Å®„Åçout=top*/
0006a8 52B9 0000       351 	add.l	#1,out0			/*out++*/
       0000            351 
0006ae 4EFA 000E       352 	jmp	OUTQ0_step2
                       353 
                       354 OUTQ0_step1:
0006b2 41F9 0000       355 	lea.l	top0,%a0
       0000            355 
0006b8 23C8 0000       356 	move.l	%a0,out0
       0000            356 
                       357 	
                       358 OUTQ0_step2:
0006be 53B9 0000       359 	sub.l	#1,s0 			/*s--*/
       0000            359 
0006c4 7001            360 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
0006c6 46DF            361 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0006c8 4CDF 0304       362 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
0006cc 4E75            363 	rts
                       364 
                       365 OUTQ1:	
0006ce 0CB9 0000       366 	cmp.l	#0,s1
       0000 0000       366 
       0000            366 
0006d8 6700 003C       367 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
0006dc 2079 0000       368 	move.l	out1,%a0			
       0000            368 
0006e2 1210            369 	move.b	(%a0),%d1		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Åã„ÇâÂèñ„ÇäÂá∫„Åó*/
0006e4 43F9 0000       370 	lea.l	bottom1,%a1
       0000            370 
0006ea B1C9            371 	cmp.l	%a1,%a0
0006ec 6700 000C       372 	beq	OUTQ1_step1		/*out==bottom„ÅÆ„Å®„Åçout=top*/
0006f0 52B9 0000       373 	add.l	#1,out1			/*out++*/
       0000            373 
0006f6 4EFA 000E       374 	jmp	OUTQ1_step2
                       375 
                       376 OUTQ1_step1:
0006fa 41F9 0000       377 	lea.l	top1,%a0
       0000            377 
000700 23C8 0000       378 	move.l	%a0,in1
       0000            378 
                       379 
                       380 OUTQ1_step2:
000706 53B9 0000       381 	sub.l	#1,s1 			/*s--*/
       0000            381 
00070c 7001            382 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
00070e 46DF            383 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000710 4CDF 0304       384 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
000714 4E75            385 	rts
                       386 
                       387 	
                       388 Queue_fail:
000716 7000            389 	move.l #0,%d0			/*Â§±Êïó„ÅÆÂ†±Âëä*/
000718 46DF            390 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
00071a 4CDF 0304       391 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
00071e 4E75            392 	rts
                       393 
                       394 INTERGET:
000720 13FC 0031       395 	move.b #'1',LED7
       00D0 002F       395 
000728 4E75            396 	rts
                       397 	
                       398 /* INTERPUT(ch)„ÄÄ„ÉÅ„É£„É≥„Éç„É´ch„ÅÆÈÄÅ‰ø°„Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„Çí‰∏Ä„Å§Âèñ„ÇäÂá∫„ÅóÂÆüÈöõ„Å´È
                       399 ÂÖ•ÂäõÔºöch->%D1.l */
                       400 INTERPUT:
00072a 13FC 0049       401 	move.b #'I',LED2
       00D0 003D       401 
000732 40E7            402 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
000734 46FC 2700       403 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
000738 0C81 0000       404 	cmp.l 	#0,%d1
       0000            404 
00073e 6600 0034       405 	bne	INTERPUT_END		/*ch„Åå0„Åß„Å™„ÅÑ„Å™„Çâ‰Ωï„ÇÇ„Åõ„Åö„Å´Âæ©Â∏∞*/
000742 7001            406     	move.l #1 , %d0          /* „Ç≠„É•„Éº1„ÇíÈÅ∏Êäû */
000744 4EBA FF1E       407 	jsr	OUTQ		        /*data->%D1.b  %D0„Å´ÁµêÊûú„ÇíÊ†ºÁ¥ç*/
000748 0C80 0000       408 	cmp.l	#0,%d0
       0000            408 
00074e 6700 0010       409 	beq	INTERPUT_fail
000752 0641 0800       410 	add.w	#0x0800,%d1
000756 33C1 00FF       411 	move.w	%d1,UTX1	/*Á¨¶Âè∑Êã°Âºµ„Åó„Å¶data„ÇíUTX1„Å´Ê†ºÁ¥ç*/
       F906            411 
00075c 4EFA 0016       412 	jmp 	INTERPUT_END
                       413 INTERPUT_fail:
000760 13FC 0046       414 	move.b #'F',LED3
       00D0 003F       414 
000768 33FC E108       415 	move.w	#U_Put_Interupt,USTCNT1	/*OUTQ„ÅåÂ§±Êïó„Å™„ÇâÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢„Å´„Åó„Å¶Âæ©Â∏∞*/
       00FF F900       415 
000770 46DF            416 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000772 4E75            417 	rts
                       418 INTERPUT_END:
000774 46DF            419 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000776 4E75            420 	rts
                       421 
                       422 ******************************************************************************
                       423 ** PUTSTRING(ch, p, size)
                       424 **ch„ÅÆÈÄÅ‰ø°„Ç≠„É•„Éº„Å´pÁï™Âú∞„Åã„ÇâÂßã„Åæ„Çãsize„Éê„Ç§„Éà„ÅÆ„Éá„Éº„Çø„ÇíÊ†ºÁ¥ç„Åó„ÄÅÈÄÅ‰ø°Ââ≤„Çä
                       425 **ÂÖ•ÂäõÔºö ch->%d1.l  p->%d2.l  size->%d3.l
                       426 **Êàª„ÇäÂÄ§ÔºöÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞ sz->d0.l
                       427 ******************************************************************************
                       428 PUTSTRING:
000778 48E7 0880       429 	movem.l	%a0/%d4,-(%sp)
00077c 40E7            430 	move.w 	%sr,-(%sp)			/*Ëµ∞Ë°å„É¨„Éô„É´ÈÄÄÈÅø*/
00077e 46FC 2700       431 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
                       432 	
000782 0C81 0000       433 	cmp.l	#0,%d1
       0000            433 
000788 6600 0038       434 	bne	PUTSTRING_END 	/*ch‚â†0„Å™„Çâ‰Ωï„ÇÇ„Åõ„ÅöÂæ©Â∏∞*/
                       435 
00078c 7800            436 	move.l	#0,%d4		/*sz->%d4*/
00078e 2042            437 	movea.l %d2,%a0 	/*i->a0*/ 
                       438 	
000790 0C83 0000       439 	cmp.l	#0,%d3
       0000            439 
000796 6700 0028       440 	beq	PUTSTRING_STEP2 /*size=0„Å™„ÇâÂàÜÂ≤ê*/
                       441 	
                       442 PUTSTRING_LOOP:
00079a B684            443 	cmp.l	%d4,%d3
00079c 6700 001A       444 	beq	PUTSTRING_STEP1 /*sz=size„Å™„ÇâÂàÜÂ≤ê*/
                       445 
0007a0 7001            446 	move.l	#1,%d0
0007a2 1218            447 	move.b 	(%a0)+,%d1
0007a4 4EBA FE0C       448 	jsr	INQ 		/*INQ(no->d0.l,data->d1.b)*/
                       449 
0007a8 0C80 0000       450 	cmp.l	#0,%d0
       0000            450 
0007ae 6700 0008       451 	beq	PUTSTRING_STEP1 /*INQ„ÅåÂ§±Êïó„Å™„ÇâÂàÜÂ≤ê*/
                       452 
0007b2 5284            453 	addq.l	#1,%d4		/*sz++*/
0007b4 6000 FFE4       454 	bra	PUTSTRING_LOOP 
                       455 	
                       456 PUTSTRING_STEP1:
0007b8 33FC E10C       457 	move.w	#0xE10C,USTCNT1 /*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       457 
                       458 		
                       459 PUTSTRING_STEP2:
0007c0 2004            460 	move.l %d4,%d0
                       461 
                       462 PUTSTRING_END:
0007c2 46DF            463 	move.w  (%sp)+, %sr			/*Ëµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0007c4 4CDF 0110       464 	movem.l	(%sp)+,%a0/%d4
0007c8 4E75            465 	rts
                       466 	
                       467 
                       468 HardwareInterface: 
0007ca 13FC 0048       469 	move.b #'H',LED1
       00D0 003B       469 
0007d2 48E7 7FFF       470 	movem.l %a0-%a7/%d1-%d7, -(%sp)
0007d6 3639 00FF       471 	move.w URX1,%d3
       F904            471 
0007dc 1403            472 	move.b %d3,%d2 /* data = %d2.b */
0007de 0243 2000       473 	andi.w #0x2000,%d3
0007e2 0C43 2000       474 	cmpi.w #0x2000,%d3 /* URX1„ÅÆ13bitÁõÆ„Åå1„ÅÆÂ†¥ÂêàINTERGETÂëº„Å≥Âá∫„Åó */
0007e6 6700 001A       475 	beq INTERGET_PREPARE
0007ea 3239 00FF       476 	move.w UTX1,%d1
       F906            476 
                       477 	**move #0x8000,%d1
0007f0 0241 8000       478 	and.w #0x8000,%d1 
0007f4 0C41 8000       479 	cmp #0x8000,%d1
0007f8 6700 0014       480 	beq INTERPUT_PREPARE
0007fc 4CDF FFFE       481         movem.l (%sp)+,%a0-%a7/%d1-%d7 
000800 4E73            482 	rte
                       483 INTERGET_PREPARE:
000802 7200            484 	moveq.l #0,%d1 /* ch = %d1.l = 0 */
000804 4EBA FF1A       485 	jsr INTERGET
000808 4CDF FFFE       486     	movem.l (%sp)+,%a0-%a7/%d1-%d7
00080c 4E73            487     	rte
                       488 INTERPUT_PREPARE:
00080e 7200            489     	move.l #0, %d1
000810 4EBA FF18       490     	jsr INTERPUT
000814 4CDF FFFE       491     	movem.l (%sp)+,%a0-%a7/%d1-%d7
000818 4E73            492     	rte
                       493 
                       494 TimerInterface:
00081a 48E7 7FFF       495 	movem.l %a0-%a7/%d1-%d7, -(%sp)
00081e 13FC 0065       496 	move.b #'e', LED4
       00D0 0029       496 
000826 0839 0000       497 	btst.b  #0, TSTAT1+1 |„Ç≥„É≥„Éö„Ç¢„Ç§„Éô„É≥„ÉàÁô∫Áîü„ÉÅ„Çß„ÉÉ„ÇØ
       00FF F60B       497 
00082e 6700 001C       498 	beq     return |Áô∫ÁîüÁÑ°„Åó„ÅßÂæ©Â∏∞
000832 13FC 006D       499 	move.b #'m', LED5
       00D0 002B       499 
00083a 33FC 0000       500 	move.w  #0x0000, TSTAT1 |„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø„ÅÆ„ÇØ„É™„Ç¢
       00FF F60A       500 
000842 4EBA 0016       501 	jsr     CALL_RP
000846 4CDF FFFE       502 	movem.l (%sp)+,%a0-%a7/%d1-%d7 
00084a 4E73            503 	rte
                       504 return:
00084c 13FC 0066       505 	move.b #'f', LED5
       00D0 002B       505 
000854 4CDF FFFE       506     	movem.l (%sp)+,%a0-%a7/%d1-%d7 
000858 4E73            507 	rte
                       508 
                       509 ******************
                       510 ** CALL_RP()
                       511 ** ÂÖ•Âäõ„ÄÅÊàª„ÇäÂÄ§„Å™„Åó
                       512 ******************
                       513 CALL_RP:
00085a 13FC 0069       514 	move.b #'i', LED6
       00D0 002D       514 
                       515 	** lea.l   task_p, %a0 /* TODO: step9„Åæ„Åß„ÅäÈ†ê„Åë */
                       516 	** movea.l (%a0), %a1 |a1=task_p /* TODO: step9„Åæ„Åß„ÅäÈ†ê„Åë */
000862 13FC 0074       517 	move.b #'t', LED7
       00D0 002F       517 
                       518 	** jsr     (%a1) |task_p„Å∏„Ç∏„É£„É≥„Éó  /* TODO: step9„Åæ„Åß„ÅäÈ†ê„Åë */
00086a 4E75            519 	rts
                       520 .end
