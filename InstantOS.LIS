                         4 .list
                         5 ***************************************************************
                         6 ** ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 ***************************************************************
                         8 ***************
                         9 ** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        10 ***************
                        11 .equ REGBASE, 0xFFF000 | DMAP „Çí‰ΩøÁî®Ôºé
                        12 .equ IOBASE, 0x00d00000
                        13 ***************
                        14 ** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        15 ***************
                        16 .equ IVR, REGBASE+0x300 | Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        17 .equ IMR, REGBASE+0x304 | Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        18 .equ ISR, REGBASE+0x30c | Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        19 .equ IPR, REGBASE+0x310 | Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        20 ***************
                        21 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        22 ***************
                        23 .equ TCTL1, REGBASE+0x600 	| „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        24 .equ TPRER1, REGBASE+0x602  | „Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        25 .equ TCMP1, REGBASE+0x604 	| „Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        26 .equ TCN1, REGBASE+0x608 	| „Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        27 .equ TSTAT1, REGBASE+0x60a 	| „Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        28 ***************
                        29 ** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        30 ***************
                        31 .equ USTCNT1, REGBASE+0x900 | UART1 „Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        32 .equ UBAUD1, REGBASE+0x902 	| UART1 „Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        33 .equ URX1, REGBASE+0x904 	| UART1 Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        34 .equ UTX1, REGBASE+0x906 	| UART1 ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        35 ***************
                        36 ** LED
                        37 ***************
                        38 .equ LED7, IOBASE+0x000002f | „Éú„Éº„ÉâÊê≠Ëºâ„ÅÆ LED Áî®„É¨„Ç∏„Çπ„Çø
                        39 .equ LED6, IOBASE+0x000002d | ‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤ A.4.3.1
                        40 .equ LED5, IOBASE+0x000002b
                        41 .equ LED4, IOBASE+0x0000029
                        42 .equ LED3, IOBASE+0x000003f
                        43 .equ LED2, IOBASE+0x000003d
                        44 .equ LED1, IOBASE+0x000003b
                        45 .equ LED0, IOBASE+0x0000039
                        46 **************
                        47 ** Êé®Â•®ÂÄ§
                        48 **************
                        49 .equ Mask_None,       0xFF3FFF
                        50 .equ Mask_UART1,      0xFF3FFB
                        51 .equ Mask_UART1_Timer,0xFF3FF9
                        52 **Timer
                        53 
                        54 **UART1
                        55 .equ U_Reset,   	  		0x0000
                        56 .equ U_Putpull,		  		0xE100
                        57 .equ U_Put_Interupt,  		0xE108
                        58 .equ U_PutPull_Interupt,	0xE10C
                        59 ***************************************************************
                        60 ** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        61 ***************************************************************
                        62 .section .bss
                        63 .even
0008c4 0000 0000        64 SYS_STK:.ds.b 0x4000 | „Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        64 
       0000 0000        64 
       0000 0000        64 
       0000 0000        64 
                        65 .even
                        66 SYS_STK_TOP: | „Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        67 *****************************************************************
                        68 **„Ç≠„É•„Éº
                        69 *****************************************************************
0048c4 0000 0000        70 top0:		.ds.b	255			/*„Ç≠„É•„Éº„ÅÆÊà¶Èóò„ÅÆÁï™Âú∞*/
       0000 0000        70 
       0000 0000        70 
       0000 0000        70 
       0000 0000        70 
0049c3 00               71 bottom0:	.ds.b	1			/*„Ç≠„É•„Éº„ÅÆÊú´Â∞æ„ÅÆÁï™Âú∞*/
0049c4 0000 0000        72 out0:		.ds.l	1			/*Ê¨°„Å´Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆ„ÅÇ„ÇãÁï™Âú∞*/
0049c8 0000 0000        73 in0:		.ds.l	1 			/*Ê¨°„Å´„Éá„Éº„Çø„ÇíÂÖ•„Çå„Çã„Åπ„ÅçÁï™Âú∞*/
0049cc 0000 0000        74 s0:		.ds.l	1			/*„Ç≠„É•„Éº„Å´Ê∫ú„Åæ„Å£„Å¶„ÅÑ„Çã„Éá„Éº„Çø„ÅÆÊï∞*/
                        75 
0049d0 0000 0000        76 top1:		.ds.b	255			/*„Ç≠„É•„Éº„ÅÆÊà¶Èóò„ÅÆÁï™Âú∞*/
       0000 0000        76 
       0000 0000        76 
       0000 0000        76 
       0000 0000        76 
004acf 00               77 bottom1:	.ds.b	1			/*„Ç≠„É•„Éº„ÅÆÊú´Â∞æ„ÅÆÁï™Âú∞*/
004ad0 0000 0000        78 out1:		.ds.l	1			/*Ê¨°„Å´Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆ„ÅÇ„ÇãÁï™Âú∞*/
004ad4 0000 0000        79 in1:		.ds.l	1 			/*Ê¨°„Å´„Éá„Éº„Çø„ÇíÂÖ•„Çå„Çã„Åπ„ÅçÁï™Âú∞*/
004ad8 0000 0000        80 s1:		.ds.l	1			/*„Ç≠„É•„Éº„Å´Ê∫ú„Åæ„Å£„Å¶„ÅÑ„Çã„Éá„Éº„Çø„ÅÆÊï∞*/
                        81 
004adc 0000 0000        82 WORK:		.ds.b 256			/* Âèó‰ø°Âà∂Âæ°ÈÉ®„ÉÜ„Çπ„Éà„ÄÄ*/
       0000 0000        82 
       0000 0000        82 
       0000 0000        82 
       0000 0000        82 
                        83 .section .data
                        84 **putstring testÁî®„ÅÆ„Éá„Éº„Çø
                        85 
0008a4 3031 3233        86 TDATA1:		.ascii "0123456789ABCDEF"
       3435 3637        86 
       3839 4142        86 
       4344 4546        86 
0008b4 6B6C 6D6E        87 TDATA2:		.ascii "klmnopqrstuvwxyz"
       6F70 7172        87 
       7374 7576        87 
       7778 797A        87 
                        88 
                        89 
                        90 
                        91 
                        92 ***************************************************************
                        93 ** ÂàùÊúüÂåñ
                        94 ** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        95 ** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤ B „Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        96 ***************************************************************
                        97 .section .text
                        98 .even
                        99 boot: * „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂ & ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700       100 move.w #0x2700,%SR
000404 4FF9 0000       101 lea.l SYS_STK_TOP, %SP 			| Set SSP
       0000            101 
                       102 
                       103 ****************
                       104 ** Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                       105 ****************
00040a 13FC 0040       106 move.b #0x40, IVR 				| „É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí0x40+level „Å´Ë®≠ÂÆöÔºé
       00FF F300       106 
000412 21FC 0000       107 move.l #HardwareInterface ,0x110| ÈÄÅÂèó‰ø°Ââ≤Ëæº„Åø„ÇíË®≠ÂÆö
       0000 0110       107 
00041a 23FC 00FF       108 move.l #Mask_None,IMR 			| All Mask
       3FFF 00FF       108 
       F304            108 
                       109 
                       110 ****************
                       111 ** ÈÄÅÂèó‰ø° (UART1) Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ (Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ 4 „Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       112 ****************
000424 33FC 0000       113 move.w #U_Reset, USTCNT1 		| „É™„Çª„ÉÉ„Éà
       00FF F900       113 
00042c 33FC E100       114 move.w #U_Putpull, USTCNT1 	    |Âèó‰ø°ÈÄÅ‰ø°ÂèØËÉΩ
       00FF F900       114 
000434 33FC 0038       115 move.w #0x0038, UBAUD1 			| baud rate = 230400 bps
       00FF F902       115 
                       116 
                       117 ****************
                       118 ** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ (Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ 6 „Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       119 *****************
00043c 33FC 0004       120 move.w #0x0004, TCTL1 | restart, Ââ≤„ÇäËæº„Åø‰∏çÂèØ,
       00FF F600       120 
                       121 | „Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ 1/16 „ÇíÂçò‰Ωç„Å®„Åó„Å¶Ë®àÊôÇÔºåa
                       122 | „Çø„Ç§„Éû‰ΩøÁî®ÂÅúÊ≠¢
                       123 
                       124 *****************
                       125 **„Ç≠„É•„ÉºÂàùÊúüÂåñ
                       126 *****************
                       127 
000444 41F9 0000       128 lea.l	top0,%a0
       0000            128 
00044a 23C8 0000       129 move.l	%a0,in0
       0000            129 
000450 23C8 0000       130 move.l  %a0,out0
       0000            130 
000456 23FC 0000       131 move.l	#0,s0
       0000 0000       131 
       0000            131 
000460 41F9 0000       132 lea.l	top1,%a0
       0000            132 
000466 23C8 0000       133 move.l	%a0,in1
       0000            133 
00046c 23C8 0000       134 move.l  %a0,out1
       0000            134 
000472 23FC 0000       135 move.l	#0,s1
       0000 0000       135 
       0000            135 
00047c 6000 0002       136 bra MAIN
                       137 
                       138 MAIN:
                       139     **jsr Put
000480 46FC 2000       140     move.w #0x2000,%SR
                       141     **jmp	INQ_OUTQ_TEST
000484 23FC 00FF       142     move.l #Mask_UART1,IMR 			| All Mask
       3FFB 00FF       142 
       F304            142 
00048e 33FC E10C       143     move.w #U_PutPull_Interupt, USTCNT1 	    |Âèó‰ø°ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ
       00FF F900       143 
000496 33FC E108       144     move.w #0xE108,USTCNT1			|Âèó‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„ÅøË®±ÂèØ
       00FF F900       144 
                       145     **jsr	PUTSTRING_TEST
00049e 4EBA 000E       146     jsr		GETSTRING_TEST
0004a2 13FC 0053       147     move.b #'S',LED0
       00D0 0039       147 
                       148 Loop:
                       149 	**jmp HardwareInterface
0004aa 6000 FFFE       150 	bra Loop
                       151 ********Âèó‰ø°Âà∂Âæ°ÈÉ®„ÅÆ„ÉÜ„Çπ„Éà
                       152 GETSTRING_TEST:
0004ae 13FC 0054       153 	move.b #'T',LED5
       00D0 002B       153 
0004b6 283C 000F       154 	move.l	#0xfffff,%d4
       FFFF            154 
                       155 GETSTRING_TEST_LOOP:
0004bc 5384            156 	sub.l	#1,%d4
0004be 6700 0006       157 	beq	GETSTRING_TEST2
0004c2 4EFA FFF8       158 	jmp	GETSTRING_TEST_LOOP
                       159 GETSTRING_TEST2:
0004c6 7200            160 	moveq #0 , %d1
0004c8 41F9 0000       161 	lea.l WORK, %a0
       0000            161 
0004ce 2408            162 	move.l %a0, %d2
0004d0 263C 0000       163 	move.l #256, %d3
       0100            163 
0004d6 13FC 0047       164 	move.b #'G',LED7
       00D0 002F       164 
0004de 4EBA 0332       165 	jsr GETSTRING
0004e2 2600            166 	move.l %d0, %d3
0004e4 7200            167 	moveq #0 , %d1
0004e6 41F9 0000       168 	lea.l WORK, %a0
       0000            168 
0004ec 2408            169 	move.l %a0, %d2
0004ee 13FC 0050       170 	move.b #'P',LED6
       00D0 002D       170 
0004f6 4EBA 02C8       171 	jsr PUTSTRING
0004fa 13FC 0053       172 	move.b #'S',LED5
       00D0 002B       172 
000502 4EFA FFAA       173 	jmp GETSTRING_TEST
                       174 	
                       175 ********INTERPUT„ÅÆÂãï‰Ωú„ÉÜ„Çπ„Éà
                       176 ********„Ç≠„É•„Éº„Å´ÊñáÂ≠ó„ÇíÊ†ºÁ¥ç„Åô„Çã
                       177 Put:
000506 48E7 E000       178     movem.l %d0-%d2, -(%sp)
00050a 123C 0061       179     move.b #0x61, %d1  |d0='a'
00050e 143C 0010       180     move.b #16, %d2
                       181 PutLoop:
000512 7001            182     move.l #1,%d0
000514 4EBA 00D2       183     jsr INQ
000518 0C80 0000       184     cmpi.l #0,%d0
       0000            184 
00051e 6700 0018       185     beq EndPut
000522 5302            186     subq.b #1 , %d2
000524 6700 0006       187     beq EndPutLoop
000528 6000 FFE8       188     bra PutLoop
                       189 EndPutLoop:
00052c 0601 0001       190     addi.b #1,%d1
000530 143C 0010       191     move.b #16,%d2
000534 6000 FFDC       192     bra PutLoop
                       193 
                       194 EndPut:
000538 23FC 0000       195     move.l #256, s1
       0100 0000       195 
       0000            195 
000542 4CDF 0007       196     movem.l (%sp)+,%d0-%d2 
000546 4E75            197 	rts
                       198 
                       199 ********PUTSTRING„ÅÆÂãï‰Ωú„ÉÜ„Çπ„Éà
                       200 ********„Ç≠„É•„Éº„Å´ÊñáÂ≠ó„ÇíÊ†ºÁ¥ç„Åô„Çã
                       201 
                       202 PUTSTRING_TEST:
000548 7200            203 	move.l	#0,%d1
00054a 45F9 0000       204 	lea.l 	TDATA1,%a2
       0000            204 
000550 240A            205 	move.l	%a2,%d2
000552 7610            206 	move.l 	#16,%d3
000554 4EBA 026A       207 	jsr	PUTSTRING
000558 283C 0000       208 	move.l	#1000,%d4
       03E8            208 
                       209 	
                       210 PUTSTRING_TEST_LOOP:
00055e 5384            211 	sub.l	#1,%d4
000560 6700 0006       212 	beq	PUTSTRING_TEST2
000564 4EFA FFF8       213 	jmp	PUTSTRING_TEST_LOOP
                       214 	
                       215 PUTSTRING_TEST2:
000568 7200            216 	move.l	#0,%d1
00056a 45F9 0000       217 	lea.l 	TDATA2,%a2
       0000            217 
000570 240A            218 	move.l	%a2,%d2
000572 7610            219 	move.l 	#16,%d3
000574 4EBA 024A       220 	jsr	PUTSTRING
000578 283C 0000       221 	move.l	#1000,%d4
       03E8            221 
00057e 4EFA 000A       222 	jmp	PUTSTRING_TEST_LOOP3
000582 4EFA FFE4       223 	jmp	PUTSTRING_TEST2
                       224 	
                       225 PUTSTRING_TEST_LOOP2:
000586 4EFA FFFE       226 	jmp	PUTSTRING_TEST_LOOP2
                       227 	
                       228 	**jmp	PUTSTRING_TEST2
                       229 	
                       230 PUTSTRING_TEST_LOOP3:
00058a 5384            231 	sub.l	#1,%d4
00058c 6700 FFDA       232 	beq	PUTSTRING_TEST2
000590 4EFA FFF8       233 	jmp	PUTSTRING_TEST_LOOP3
                       234 
                       235 **inq outq„Å¶„Åô„Å®
                       236 
                       237 
                       238 INQ_OUTQ_TEST:
000594 4EBA 003E       239 	jsr 	INQ_INPUT
000598 4EBA 003A       240 	jsr 	INQ_INPUT
00059c 4EBA 0036       241 	jsr 	INQ_INPUT
0005a0 4EBA 0032       242 	jsr 	INQ_INPUT
0005a4 4EBA 002E       243 	jsr 	INQ_INPUT
0005a8 4EBA 002A       244 	jsr 	INQ_INPUT
0005ac 4EBA 0026       245 	jsr 	INQ_INPUT
0005b0 4EBA 0022       246 	jsr 	INQ_INPUT
0005b4 4EBA 001E       247 	jsr 	INQ_INPUT
0005b8 4EBA 001A       248 	jsr 	INQ_INPUT
0005bc 4EBA 0022       249 	jsr 	OUTQ_INPUT
0005c0 4EBA 001E       250 	jsr 	OUTQ_INPUT
0005c4 4EBA 001A       251 	jsr 	OUTQ_INPUT
0005c8 4EBA 0016       252 	jsr 	OUTQ_INPUT
0005cc 4EBA 0012       253 	jsr 	OUTQ_INPUT
0005d0 4EFA FFC2       254 	jmp	INQ_OUTQ_TEST
                       255 	
                       256 
                       257 INQ_INPUT:
0005d4 7000            258 	move.l #0,%d0
0005d6 123C 0061       259 	move.b #0x61,%d1
0005da 4EBA 000C       260 	jsr INQ
0005de 4E75            261 	rts
                       262 
                       263 OUTQ_INPUT:
0005e0 7000            264 	move.l #0,%d0
0005e2 4EBA 00B6       265 	jsr OUTQ
0005e6 4E75            266 	rts
                       267 	
                       268 
                       269 
                       270 INQ:
                       271 	**	Áï™Âè∑no„ÅÆ„Ç≠„É•„Éº„Å´„Éá„Éº„Çø„Çí„ÅÑ„Çå„Çã
                       272 	**	ÂÖ•Âäõ no->d0.l	Êõ∏„ÅçËæº„ÇÄ8bitdata->d1.b
                       273 	**	Âá∫Âäõ Â§±Êïó0/ÊàêÂäü1 ->d0.l
0005e8 48E7 20C0       274 	movem.l	%a0/%a1/%d2,-(%sp)	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Å´„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
0005ec 40E7            275 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
0005ee 46FC 2700       276 	move.w 	#0x2700,%SR			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
0005f2 0C80 0000       277 	cmp.l 	#0,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå0*/
       0000            277 
0005f8 6700 0010       278 	beq	INQ0
0005fc 0C80 0000       279 	cmp.l 	#1,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå1*/
       0001            279 
000602 6700 004E       280 	beq	INQ1
000606 4EFA 0144       281 	jmp	Queue_fail		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ*/
                       282 
                       283 	
                       284 INQ0:	
00060a 0CB9 0000       285 	cmp.l	#256,s0
       0100 0000       285 
       0000            285 
000614 6700 0136       286 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
000618 2079 0000       287 	move.l	in0,%a0			
       0000            287 
00061e 1081            288 	move.b	%d1,(%a0)		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Å´Êõ∏„ÅçËæº„Åø*/
000620 43F9 0000       289 	lea.l	bottom0,%a1
       0000            289 
000626 B1C9            290 	cmp.l	%a1,%a0
000628 6700 000C       291 	beq	INQ0_step1		/*in==bottom„ÅÆ„Å®„Åçin=top*/
00062c 52B9 0000       292 	add.l	#1,in0			/*in++*/
       0000            292 
000632 4EFA 000E       293 	jmp	INQ0_step2
                       294 
                       295 INQ0_step1:
000636 41F9 0000       296 	lea.l	top0,%a0
       0000            296 
00063c 23C8 0000       297 	move.l	%a0,in0
       0000            297 
                       298 	
                       299 
                       300 INQ0_step2:
000642 52B9 0000       301 	add.l	#1,s0 			/*s++*/
       0000            301 
000648 7001            302 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
00064a 46DF            303 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
00064c 4CDF 0304       304 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
000650 4E75            305 	rts
                       306 
                       307 INQ1:	
000652 0CB9 0000       308 	cmp.l	#256,s1
       0100 0000       308 
       0000            308 
00065c 6700 00EE       309 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
000660 2079 0000       310 	move.l	in1,%a0			
       0000            310 
000666 1081            311 	move.b	%d1,(%a0)		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Å´Êõ∏„ÅçËæº„Åø*/
000668 43F9 0000       312 	lea.l	bottom1,%a1
       0000            312 
00066e B1C9            313 	cmp.l	%a1,%a0
000670 6700 000C       314 	beq	INQ1_step1		/*in==bottom„ÅÆ„Å®„Åçin=top*/
000674 52B9 0000       315 	add.l	#1,in1			/*in++*/
       0000            315 
00067a 4EFA 000E       316 	jmp	INQ1_step2
                       317 
                       318 INQ1_step1:
00067e 41F9 0000       319 	lea.l	top1,%a0
       0000            319 
000684 23C8 0000       320 	move.l	%a0,in1
       0000            320 
                       321 
                       322 INQ1_step2:
00068a 52B9 0000       323 	add.l	#1,s1 			/*s++*/
       0000            323 
000690 7001            324 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
000692 46DF            325 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000694 4CDF 0304       326 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
000698 4E75            327 	rts
                       328 
                       329 
                       330 OUTQ:
                       331 	**	Áï™Âè∑no„ÅÆ„Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„Çí‰∏Ä„Å§Âèñ„ÇäÂá∫„Åô
                       332 	**	ÂÖ•Âäõ „Ç≠„É•„Éº„ÅÆÁï™Âè∑->d0.l
                       333 	**	Âá∫Âäõ Â§±Êïó0/ÊàêÂäü1 ->d0.l		Âèñ„ÇäÂá∫„Åó„Åü8bitdata ->d1.b
00069a 48E7 20C0       334 	movem.l	%a0/%a1/%d2,-(%sp)	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Å´„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
00069e 40E7            335 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
0006a0 46FC 2700       336 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
0006a4 0C80 0000       337 	cmp.l 	#0,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå0*/
       0000            337 
0006aa 6700 0010       338 	beq	OUTQ0
0006ae 0C80 0000       339 	cmp.l 	#1,%d0			/*„Ç≠„É•„ÉºÁï™Âè∑„Åå1*/
       0001            339 
0006b4 6700 004E       340 	beq	OUTQ1
0006b8 4EFA 0092       341 	jmp	Queue_fail		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ*/
                       342 	
                       343 
                       344 OUTQ0:	
0006bc 0CB9 0000       345 	cmp.l	#0,s0
       0000 0000       345 
       0000            345 
0006c6 6700 0084       346 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
0006ca 2079 0000       347 	move.l	out0,%a0			
       0000            347 
0006d0 1210            348 	move.b	(%a0),%d1		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Åã„ÇâÂèñ„ÇäÂá∫„Åó*/
0006d2 43F9 0000       349 	lea.l	bottom0,%a1
       0000            349 
0006d8 B1C9            350 	cmp.l	%a1,%a0
0006da 6700 000C       351 	beq	OUTQ0_step1		/*out==bottom„ÅÆ„Å®„Åçout=top*/
0006de 52B9 0000       352 	add.l	#1,out0			/*out++*/
       0000            352 
0006e4 4EFA 000E       353 	jmp	OUTQ0_step2
                       354 
                       355 OUTQ0_step1:
0006e8 41F9 0000       356 	lea.l	top0,%a0
       0000            356 
0006ee 23C8 0000       357 	move.l	%a0,out0
       0000            357 
                       358 	
                       359 OUTQ0_step2:
0006f4 53B9 0000       360 	sub.l	#1,s0 			/*s--*/
       0000            360 
0006fa 7001            361 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
0006fc 46DF            362 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0006fe 4CDF 0304       363 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
000702 4E75            364 	rts
                       365 
                       366 OUTQ1:	
000704 0CB9 0000       367 	cmp.l	#0,s1
       0000 0000       367 
       0000            367 
00070e 6700 003C       368 	beq	Queue_fail		/*„Ç≠„É•„Éº„ÅåÊ∫ÄÊùØ„ÅßÂ§±Êïó*/
000712 2079 0000       369 	move.l	out1,%a0			
       0000            369 
000718 1210            370 	move.b	(%a0),%d1		/*„Éá„Éº„Çø„Çí„Ç≠„É•„Éº„Åã„ÇâÂèñ„ÇäÂá∫„Åó*/
00071a 43F9 0000       371 	lea.l	bottom1,%a1
       0000            371 
000720 B1C9            372 	cmp.l	%a1,%a0
000722 6700 000C       373 	beq	OUTQ1_step1		/*out==bottom„ÅÆ„Å®„Åçout=top*/
000726 52B9 0000       374 	add.l	#1,out1			/*out++*/
       0000            374 
00072c 4EFA 000E       375 	jmp	OUTQ1_step2
                       376 
                       377 OUTQ1_step1:
000730 41F9 0000       378 	lea.l	top1,%a0
       0000            378 
000736 23C8 0000       379 	move.l	%a0,in1
       0000            379 
                       380 
                       381 OUTQ1_step2:
00073c 53B9 0000       382 	sub.l	#1,s1 			/*s--*/
       0000            382 
000742 7001            383 	move.l	#1,%d0			/*ÊàêÂäü„ÇíÂ†±Âëä*/
000744 46DF            384 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000746 4CDF 0304       385 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
00074a 4E75            386 	rts
                       387 
                       388 	
                       389 Queue_fail:
00074c 7000            390 	move.l #0,%d0			/*Â§±Êïó„ÅÆÂ†±Âëä*/
00074e 46DF            391 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000750 4CDF 0304       392 	movem.l (%sp)+,%a0/%a1/%d2	/*Âàá„ÇäÊõø„ÅàÂâç„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Åã„Çâ„É¨„Ç∏„Çπ„ÇøÂõûÂæ©*/
000754 4E75            393 	rts
                       394 
                       395  
                       396 ***************************************************
                       397 **INTERGET(ch,data)„ÄÄÂèó‰ø°„Éá„Éº„Çø„ÇíÂèó‰ø°„Ç≠„É•„Éº„Å´Ê†ºÁ¥ç„Åô„Çã
                       398 **ÂÖ•ÂäõÔºöch->%d1.l data->%d2.b
                       399 ***************************************************
                       400 INTERGET:
000756 40E7            401 	move.w 	%sr,-(%sp)	/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
000758 46FC 2700       402 	move.w 	#0x2700,%sr	/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
00075c 0C81 0000       403 	cmp.l 	#0,%d1
       0000            403 
000762 6600 000A       404 	bne	INTERGET_END	/*ch„Åå0„Åß„Å™„ÅÑ„Å™„Çâ‰Ωï„ÇÇ„Åõ„Åö„Å´Âæ©Â∏∞*/
                       405 	
000766 7000            406     	move.l	#0,%d0          /* „Ç≠„É•„Éº0„ÇíÈÅ∏Êäû */
000768 1202            407 	move.b	%d2,%d1		
00076a 4EBA FE7C       408 	jsr	INQ		/*INQ(no->%d0.l,data->%d1.b) %D0.l„ÅßÁµêÊûú„ÇíÂ†±Âëä*/
                       409 
                       410 INTERGET_END:
00076e 46DF            411 	move.w  (%sp)+, %sr	/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
000770 4E75            412 	rts
                       413 
                       414 
                       415 /* INTERPUT(ch)„ÄÄ„ÉÅ„É£„É≥„Éç„É´ch„ÅÆÈÄÅ‰ø°„Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„Çí‰∏Ä„Å§Âèñ„ÇäÂá∫„ÅóÂÆüÈöõ„Å´È
                       416 ÂÖ•ÂäõÔºöch->%D1.l */
                       417 INTERPUT:
000772 13FC 0049       418 	move.b #'I',LED2
       00D0 003D       418 
00077a 40E7            419 	move.w 	%sr,-(%sp)				/*sr„ÅÆÂÄ§„Çí‰∏ÄÊôÇÈÄÄÈÅø*/
00077c 46FC 2700       420 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
000780 0C81 0000       421 	cmp.l 	#0,%d1
       0000            421 
000786 6600 0034       422 	bne	INTERPUT_END		/*ch„Åå0„Åß„Å™„ÅÑ„Å™„Çâ‰Ωï„ÇÇ„Åõ„Åö„Å´Âæ©Â∏∞*/
00078a 7001            423     	move.l #1 , %d0          /* „Ç≠„É•„Éº1„ÇíÈÅ∏Êäû */
00078c 4EBA FF0C       424 	jsr	OUTQ		        /*data->%D1.b  %D0„Å´ÁµêÊûú„ÇíÊ†ºÁ¥ç*/
000790 0C80 0000       425 	cmp.l	#0,%d0
       0000            425 
000796 6700 0010       426 	beq	INTERPUT_fail
00079a 0641 0800       427 	add.w	#0x0800,%d1
00079e 33C1 00FF       428 	move.w	%d1,UTX1	/*Á¨¶Âè∑Êã°Âºµ„Åó„Å¶data„ÇíUTX1„Å´Ê†ºÁ¥ç*/
       F906            428 
0007a4 4EFA 0016       429 	jmp 	INTERPUT_END
                       430 INTERPUT_fail:
0007a8 13FC 0046       431 	move.b #'F',LED3
       00D0 003F       431 
0007b0 33FC E108       432 	move.w	#U_Put_Interupt,USTCNT1	/*OUTQ„ÅåÂ§±Êïó„Å™„ÇâÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢„Å´„Åó„Å¶Âæ©Â∏∞*/
       00FF F900       432 
0007b8 46DF            433 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0007ba 4E75            434 	rts
                       435 INTERPUT_END:
0007bc 46DF            436 	move.w  (%sp)+, %sr			/*„Çπ„Éº„Éë„Éº„Çπ„Çø„ÉÉ„ÇØ„Åã„ÇâËµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
0007be 4E75            437 	rts
                       438 
                       439 ******************************************************************************
                       440 ** PUTSTRING(ch, p, size)
                       441 **ch„ÅÆÈÄÅ‰ø°„Ç≠„É•„Éº„Å´pÁï™Âú∞„Åã„ÇâÂßã„Åæ„Çãsize„Éê„Ç§„Éà„ÅÆ„Éá„Éº„Çø„ÇíÊ†ºÁ¥ç„Åó„ÄÅÈÄÅ‰ø°Ââ≤„Çä
                       442 **ÂÖ•ÂäõÔºö ch->%d1.l  p->%d2.l  size->%d3.l
                       443 **Êàª„ÇäÂÄ§ÔºöÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞ sz->d0.l
                       444 ******************************************************************************
                       445 PUTSTRING:
0007c0 48E7 0880       446 	movem.l	%a0/%d4,-(%sp)
0007c4 40E7            447 	move.w 	%sr,-(%sp)			/*Ëµ∞Ë°å„É¨„Éô„É´ÈÄÄÈÅø*/
0007c6 46FC 2700       448 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
                       449 	
0007ca 0C81 0000       450 	cmp.l	#0,%d1
       0000            450 
0007d0 6600 0038       451 	bne	PUTSTRING_END 	/*ch‚â†0„Å™„Çâ‰Ωï„ÇÇ„Åõ„ÅöÂæ©Â∏∞*/
                       452 
0007d4 7800            453 	move.l	#0,%d4		/*sz->%d4*/
0007d6 2042            454 	movea.l %d2,%a0 	/*i->a0*/ 
                       455 	
0007d8 0C83 0000       456 	cmp.l	#0,%d3
       0000            456 
0007de 6700 0028       457 	beq	PUTSTRING_STEP2 /*size=0„Å™„ÇâÂàÜÂ≤ê*/
                       458 	
                       459 PUTSTRING_LOOP:
0007e2 B684            460 	cmp.l	%d4,%d3
0007e4 6700 001A       461 	beq	PUTSTRING_STEP1 /*sz=size„Å™„ÇâÂàÜÂ≤ê*/
                       462 
0007e8 7001            463 	move.l	#1,%d0
0007ea 1218            464 	move.b 	(%a0)+,%d1
0007ec 4EBA FDFA       465 	jsr	INQ 		/*INQ(no->d0.l,data->d1.b)*/
                       466 
0007f0 0C80 0000       467 	cmp.l	#0,%d0
       0000            467 
0007f6 6700 0008       468 	beq	PUTSTRING_STEP1 /*INQ„ÅåÂ§±Êïó„Å™„ÇâÂàÜÂ≤ê*/
                       469 
0007fa 5284            470 	addq.l	#1,%d4		/*sz++*/
0007fc 6000 FFE4       471 	bra	PUTSTRING_LOOP 
                       472 	
                       473 PUTSTRING_STEP1:
000800 33FC E10C       474 	move.w	#0xE10C,USTCNT1 /*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       474 
                       475 		
                       476 PUTSTRING_STEP2:
000808 2004            477 	move.l %d4,%d0
                       478 
                       479 PUTSTRING_END:
00080a 46DF            480 	move.w  (%sp)+, %sr			/*Ëµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
00080c 4CDF 0110       481 	movem.l	(%sp)+,%a0/%d4
000810 4E75            482 	rts
                       483 
                       484 
                       485  ******************************************************************************
                       486 ** GETSTRING(ch, p, size)
                       487 **ch„ÅÆÂèó‰ø°„Ç≠„É•„Éº„Åã„Çâsize„Éê„Ç§„Éà„ÅÆ„Éá„Éº„Çø„ÇíÂèñ„ÇäÂá∫„Åó„ÄÅpÁï™Âú∞‰ª•Èôç„Å´„Ç≥„Éî„Éº„Åô
                       488 **ÂÖ•ÂäõÔºö ch->%d1.l  p->%d2.l  size->%d3.l
                       489 **Êàª„ÇäÂÄ§ÔºöË™≠„Åø„Å†„Åó„Åü„Éá„Éº„ÇøÊï∞ sz->d0.l
                       490 ******************************************************************************
                       491 GETSTRING:
000812 48E7 0880       492 	movem.l	%a0/%d4,-(%sp)
000816 40E7            493 	move.w 	%sr,-(%sp)			/*Ëµ∞Ë°å„É¨„Éô„É´ÈÄÄÈÅø*/
000818 46FC 2700       494 	move.w 	#0x2700,%sr			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢(Ëµ∞Ë°å„É¨„Éô„É´7)*/
                       495 	
00081c 0C81 0000       496 	cmp.l	#0,%d1
       0000            496 
000822 6600 0028       497 	bne	GETSTRING_END 	/*ch‚â†0„Å™„Çâ‰Ωï„ÇÇ„Åõ„ÅöÂæ©Â∏∞*/
                       498 
000826 7800            499 	move.l	#0,%d4		/*sz->%d4*/
000828 2042            500 	movea.l %d2,%a0 	/*i->a0*/ 
                       501 	
                       502 GETSTRING_LOOP:
00082a B684            503 	cmp.l	%d4,%d3
00082c 6700 001C       504 	beq	GETSTRING_STEP1 /*sz=size„Å™„ÇâÂàÜÂ≤ê*/
                       505 
000830 7000            506 	move.l	#0,%d0
000832 4EBA FE66       507 	jsr	OUTQ 
                       508 	
000836 0C80 0000       509 	cmp.l	#0,%d0
       0000            509 
00083c 6700 000C       510 	beq	GETSTRING_STEP1 /*OUTQ„ÅåÂ§±Êïó„Å™„ÇâÂàÜÂ≤ê*/
000840 1081            511 	move.b %d1,(%a0)	/*iÁï™Âú∞„Å´„Éá„Éº„Çø„Çí„Ç≥„Éî„Éº*/
                       512 
000842 5284            513 	addq.l	#1,%d4		/*sz++*/
000844 5288            514 	addq.l	#1,%a0		/*i++*/
000846 6000 FFE2       515 	bra	GETSTRING_LOOP 
                       516 		
                       517 GETSTRING_STEP1:
00084a 2004            518 	move.l %d4,%d0
                       519 
                       520 GETSTRING_END:
00084c 46DF            521 	move.w  (%sp)+, %sr			/*Ëµ∞Ë°å„É¨„Éô„É´ÂõûÂæ©*/
00084e 4CDF 0110       522 	movem.l	(%sp)+,%a0/%d4
000852 4E75            523 	rts
                       524 	
                       525 
                       526 HardwareInterface: 
000854 13FC 0048       527 	move.b #'H',LED1
       00D0 003B       527 
00085c 48E7 7FFF       528 	movem.l %a0-%a7/%d1-%d7, -(%sp)
000860 3639 00FF       529 	move.w URX1,%d3
       F904            529 
000866 1403            530 	move.b %d3,%d2 /* data = %d2.b */
000868 0243 2000       531 	andi.w #0x2000,%d3
00086c 0C43 2000       532 	cmpi.w #0x2000,%d3 /* URX1„ÅÆ13bitÁõÆ„Åå1„ÅÆÂ†¥ÂêàINTERGETÂëº„Å≥Âá∫„Åó */
000870 6700 001A       533 	beq INTERGET_PREPARE
000874 3239 00FF       534 	move.w UTX1,%d1
       F906            534 
                       535 	**move #0x8000,%d1
00087a 0241 8000       536 	and.w #0x8000,%d1 
00087e 0C41 8000       537 	cmp #0x8000,%d1
000882 6700 0014       538 	beq INTERPUT_PREPARE
000886 4CDF FFFE       539         movem.l (%sp)+,%a0-%a7/%d1-%d7 
00088a 4E73            540 	rte
                       541 INTERGET_PREPARE:
00088c 7200            542 	moveq.l #0,%d1 /* ch = %d1.l = 0 */
00088e 4EBA FEC6       543 	jsr INTERGET
000892 4CDF FFFE       544     	movem.l (%sp)+,%a0-%a7/%d1-%d7
000896 4E73            545     	rte
                       546 INTERPUT_PREPARE:
000898 7200            547     	move.l #0, %d1
00089a 4EBA FED6       548     	jsr INTERPUT
00089e 4CDF FFFE       549     	movem.l (%sp)+,%a0-%a7/%d1-%d7
0008a2 4E73            550     	rte
                       551 .end
